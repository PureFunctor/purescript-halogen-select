



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Building blocks for common selection user interfaces in PureScript & Halogen">
      
      
        <link rel="canonical" href="https://citizennet.github.io/purescript-halogen-select/tutorials/dropdown/">
      
      
        <meta name="author" content="Thomas Honeyman">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Build a PureScript Dropdown in Halogen</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#00bcd4">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Open Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/Select.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="cyan" data-md-color-accent="cyan">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#lets-build-a-dropdown-in-purescript" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://citizennet.github.io/purescript-halogen-select" title="Select Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Select Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Build a PureScript Dropdown in Halogen
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/citizennet/purescript-halogen-select/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    purescript-halogen-select
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://citizennet.github.io/purescript-halogen-select" title="Select Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    Select Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/citizennet/purescript-halogen-select/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    purescript-halogen-select
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../getting-started/" title="Project setup" class="md-nav__link">
      Project setup
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Build a dropdown
      </label>
    
    <a href="./" title="Build a dropdown" class="md-nav__link md-nav__link--active">
      Build a dropdown
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-setup" class="md-nav__link">
    Basic Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rendering-a-button-and-items" class="md-nav__link">
    Rendering a button and items
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-better-state-type" class="md-nav__link">
    A better State type
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrating-the-component" class="md-nav__link">
    Integrating the component
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#on-building-components-with-select" class="md-nav__link">
    On building components with Select
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-the-select-component" class="md-nav__link">
    Importing the Select component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mounting-the-component" class="md-nav__link">
    Mounting the component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adapting-the-render-function-for-select" class="md-nav__link">
    Adapting the render function for Select
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrating-behavior" class="md-nav__link">
    Integrating Behavior
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attaching-behavior-to-select" class="md-nav__link">
    Attaching behavior to Select
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-messages-from-select" class="md-nav__link">
    Handling messages from Select
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-code" class="md-nav__link">
    Source Code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../typeahead/" title="Build a typeahead" class="md-nav__link">
      Build a typeahead
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      How To
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        How To
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../how-to/embed-parent-queries/" title="How to embed parent queries" class="md-nav__link">
      How to embed parent queries
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Concepts
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Concepts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../concepts/understanding-free-queries/" title="Understanding free queries" class="md-nav__link">
      Understanding free queries
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../examples/" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-setup" class="md-nav__link">
    Basic Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rendering-a-button-and-items" class="md-nav__link">
    Rendering a button and items
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-better-state-type" class="md-nav__link">
    A better State type
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrating-the-component" class="md-nav__link">
    Integrating the component
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#on-building-components-with-select" class="md-nav__link">
    On building components with Select
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-the-select-component" class="md-nav__link">
    Importing the Select component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mounting-the-component" class="md-nav__link">
    Mounting the component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adapting-the-render-function-for-select" class="md-nav__link">
    Adapting the render function for Select
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrating-behavior" class="md-nav__link">
    Integrating Behavior
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attaching-behavior-to-select" class="md-nav__link">
    Attaching behavior to Select
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-messages-from-select" class="md-nav__link">
    Handling messages from Select
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-code" class="md-nav__link">
    Source Code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/citizennet/purescript-halogen-select/edit/master/docs/tutorials/dropdown.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="lets-build-a-dropdown-in-purescript">Let's Build a Dropdown in PureScript!<a class="headerlink" href="#lets-build-a-dropdown-in-purescript" title="Permanent link">&para;</a></h1>
<p>Dropdowns are among the simplest selection components you will build, but they can be tricky to get right. For example, you'll likely want to ensure that your users can type to highlight close text matches (like when you type "Ca" to highlight "California" in a state dropdown). You'll want to be accessible to folks using screen readers or keyboard-only navigation, too. And, of course, you'll want to achieve all this without compromising on your design.</p>
<p>This tutorial is intended as a beginner-friendly, thorough introduction to <code>Select</code>. We'll build a functional dropdown complete with keyboard navigation. Along the way, we'll learn more about how to work with Halogen components, diagnose type errors, and other common PureScript tasks.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This tutorial assumes you've followed the steps in the <a href="https://citizennet.github.io/purescript-halogen-select/tutorials/getting-started/">Project Setup</a> section. While not necessary, this code is tested with those steps in mind.</p>
<p>It also assumes familiarity with the Halogen framework. If you need a refresher, try the official <a href="https://github.com/slamdata/purescript-halogen/tree/master/docs">Halogen guide</a> or the <a href="https://citizennet.github.io/purescript-halogen-select/tutorials/getting-started/#a-whirlwind-tour-of-our-starter-component">whirlwind tour</a> of our starter component.</p>
<div class="admonition warning">
<p><strong>If you are already an intermediate or advanced PureScript developer, then this tutorial will read slowly for you. Feel free to skim, get the gist of how the library works, and then move on to the <a href="https://citizennet.github.io/purescript-halogen-select/tutorials/typeahead">faster-paced and more advanced typeahead tutorial</a>.</strong></p>
</div>
<p>Your code should work at the end of every step. If you run into issues or your code doesn't compile, please come visit us on the <a href="https://discourse.purescript.org">PureScript user forum</a> or the <a href="https://functionalprogramming.slack.com">#fpchat Slack channel</a>.</p>
</div>
<p>We're going to build a dropdown that is functionally equivalent this one:</p>
<div class="ocelot-scoped" data-component="dropdown"></div>

<h2 id="basic-setup">Basic Setup<a class="headerlink" href="#basic-setup" title="Permanent link">&para;</a></h2>
<p>Let's get something on the screen!</p>
<p>The simplest sort of dropdown has a button that can toggle a menu open or closed, a list of items that can be selected from that menu, and zero, one, or more selected items. For our dropdown we'll assume that you can select at most one item, and that selecting an item will replace the text on the button with that item.</p>
<h3 id="rendering-a-button-and-items">Rendering a button and items<a class="headerlink" href="#rendering-a-button-and-items" title="Permanent link">&para;</a></h3>
<p>We'll start by rendering the button and the items. At this point our render function contains only an empty div, so let's fill in the rest of the HTML we need:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">render</span> <span class="ow">::</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentHTML</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="n">m</span>
<span class="nf">render</span> <span class="n">st</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">h1_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;Dropdown&quot;</span> <span class="p">]</span>
  <span class="p">,</span> <span class="kt">HH</span><span class="o">.</span><span class="n">button_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;Click me to view some items&quot;</span> <span class="p">]</span>
  <span class="p">,</span> <span class="kt">HH</span><span class="o">.</span><span class="n">ul_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">li_</span>
      <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;Item 1&quot;</span> <span class="p">]</span>
    <span class="p">,</span> <span class="kt">HH</span><span class="o">.</span><span class="n">li_</span>
      <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;Item 2&quot;</span> <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
</pre></div>
</td></tr></table>

<div class="admonition danger">
<p>Make sure to compile this code and view the new output! You should see a header, a button, and two items in the list. After each step, make sure your code still compiles.</p>
</div>
<h3 id="a-better-state-type">A better <code class="codehilite"><span class="kt">State</span></code> type<a class="headerlink" href="#a-better-state-type" title="Permanent link">&para;</a></h3>
<p>It's already clear we're going to need more than <code class="codehilite"><span class="kt">Unit</span></code> for our <code class="codehilite"><span class="kt">State</span></code> type. We at least need to know three things:</p>
<ul>
<li>If the menu is toggled on or off</li>
<li>The currently-selected item (if there is one)</li>
<li>The list of items available for selection</li>
</ul>
<p>We can represent each of these with simple types in our state:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">type</span> <span class="kt">State</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="n">isOpen</span> <span class="ow">::</span> <span class="kt">Boolean</span>
  <span class="p">,</span> <span class="n">selectedItem</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">String</span>
  <span class="p">,</span> <span class="n">availableItems</span> <span class="ow">::</span> <span class="kt">Array</span> <span class="kt">String</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Now that our state contains these three fields, we need to update our <code class="codehilite"><span class="nf">initialState</span></code> function to produce the right type of values:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">initialState</span> <span class="ow">::</span> <span class="kt">Input</span> <span class="ow">-&gt;</span> <span class="kt">State</span>
<span class="nf">initialState</span> <span class="ow">=</span> <span class="n">const</span>
  <span class="p">{</span> <span class="n">isOpen</span><span class="kt">:</span> <span class="n">false</span>
  <span class="p">,</span> <span class="n">selectedItem</span><span class="kt">:</span> <span class="kt">Nothing</span>
  <span class="p">,</span> <span class="n">availableItems</span><span class="kt">:</span>
      <span class="p">[</span> <span class="s">&quot;Item One&quot;</span>
      <span class="p">,</span> <span class="s">&quot;Item Two&quot;</span>
      <span class="p">,</span> <span class="s">&quot;Item Three&quot;</span>
      <span class="p">]</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Finally, lets update our render function to leverage the information now contained in <code class="codehilite"><span class="kt">State</span></code>. If there's a selected item, that will be the button's text; if not, we'll fall back to a default message. If the menu is open, we'll list out the available items for selection.</p>
<p>For code clarity, we'll also break out the dropdown into its own helper function.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Data.Maybe</span> <span class="p">(</span><span class="nf">fromMaybe</span><span class="p">)</span>

<span class="nf">render</span> <span class="ow">::</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentHTML</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="n">m</span>
<span class="nf">render</span> <span class="n">st</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">h1_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;Dropdown&quot;</span> <span class="p">]</span>
  <span class="p">,</span> <span class="n">dropdown</span> <span class="n">st</span>
  <span class="p">]</span>

<span class="nf">dropdown</span> <span class="ow">::</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentHTML</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="n">m</span>
<span class="nf">dropdown</span> <span class="n">st</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">button_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="o">$</span> <span class="n">fromMaybe</span> <span class="s">&quot;Click me to view some items&quot;</span> <span class="n">st</span><span class="o">.</span><span class="n">selectedItem</span> <span class="p">]</span>
  <span class="p">,</span> <span class="kr">if</span> <span class="n">st</span><span class="o">.</span><span class="n">isOpen</span>
      <span class="kr">then</span> <span class="kt">HH</span><span class="o">.</span><span class="n">ul_</span> <span class="o">$</span> <span class="p">(</span><span class="nf">\</span><span class="n">item</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">li_</span> <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">])</span> <span class="o">&lt;$&gt;</span> <span class="n">st</span><span class="o">.</span><span class="n">availableItems</span>
      <span class="kr">else</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;&quot;</span>
  <span class="p">]</span>
</pre></div>
</td></tr></table>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Since the dropdown has no behavior yet, try changing the <code class="codehilite"><span class="nf">initialState</span></code> to set <code class="codehilite"><span class="nf">isOpen</span></code> to <code class="codehilite"><span class="nf">true</span></code> to verify your items are in fact being rendered out to the page.</p>
</div>
<p>It ain't pretty, but at this point we've got all the rendering we need for a basic dropdown! The next step is to actually wire in some behavior.</p>
<h2 id="integrating-the-component">Integrating the component<a class="headerlink" href="#integrating-the-component" title="Permanent link">&para;</a></h2>
<p>Let's integrate the <code>Select</code> component! In just a few steps, we'll turn our simple render function into a fully-functioning dropdown with keyboard navigation, toggling, debounced type-to-search, and several other features.</p>
<h3 id="on-building-components-with-select">On building components with Select<a class="headerlink" href="#on-building-components-with-select" title="Permanent link">&para;</a></h3>
<p>The key idea behind the <code>Select</code> library is to <strong>provide behaviors, not rendering</strong>. The core component the library exposes doesn't have a render function at all! Of course, all Halogen components require a render function to work, and <code>Select</code> is no different. <em>You</em> are expected to provide that render function.</p>
<p>Why?</p>
<p>When you write the render function, not the library, you get to decide exactly what your component will look and feel like. You can also control what queries to trigger from HTML and when, effectively allowing you to control the behavior of the component <em>without configuration</em>. You can even extend it with new behavior and new state by using information from your parent component. The end result is a much smaller library component with a lot more flexibility and power for you.</p>
<p>We just wrote the rendering we need for an (admittedly ugly) dropdown. The render function we just wrote can actually serve almost as-is as the render function for <code>Select</code>! All we have to do is mount the <code>Select</code> component, make a few tweaks to our render code, and then pass in a little configuration information. Let's do that next.</p>
<h3 id="importing-the-select-component">Importing the Select component<a class="headerlink" href="#importing-the-select-component" title="Permanent link">&para;</a></h3>
<p>The first thing we'll do is bring in the <code>Select</code> library in the first place.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Select</span> <span class="k">as</span> <span class="n">Select</span>
<span class="kr">import</span> <span class="nn">Select.Setters</span> <span class="k">as</span> <span class="n">Setters</span>
</pre></div>
</td></tr></table>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can always <a href="https://pursuit.purescript.org/packages/purescript-halogen-select">view the module documentation for Select on Pursuit</a> or the <a href="https://github.com/citizennet/purescript-halogen-select">source code on GitHub</a>. This is useful when integrating with third-party components so that you can check out the <code class="codehilite"><span class="kt">Input</span></code>, <code class="codehilite"><span class="kt">State</span></code>, <code class="codehilite"><span class="kt">Query</span></code>, and <code class="codehilite"><span class="kt">Message</span></code> types.</p>
</div>
<p>Next, we need to update our <code class="codehilite"><span class="kt">ChildSlot</span></code> and <code class="codehilite"><span class="kt">ChildQuery</span></code> types. We're only going to have one dropdown so we can leave the child slot as <code class="codehilite"><span class="kt">Unit</span></code>; we do need to add the <code>Select</code> component's query type to our <code class="codehilite"><span class="kt">ChildQuery</span></code> synonym, however.</p>
<p>This code, unfortunately, won't work:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">type</span> <span class="kt">ChildQuery</span> <span class="ow">=</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Query</span>

<span class="kt">Error</span> <span class="n">found</span><span class="kt">:</span>
  <span class="kt">Type</span> <span class="n">synonym</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Query</span> <span class="n">is</span> <span class="n">partially</span> <span class="n">applied</span><span class="o">.</span>
  <span class="kt">Type</span> <span class="n">synonyms</span> <span class="n">must</span> <span class="n">be</span> <span class="n">applied</span> <span class="n">to</span> <span class="n">all</span> <span class="kr">of</span> <span class="n">their</span> <span class="kr">type</span> <span class="n">arguments</span><span class="o">.</span>

<span class="kr">in</span> <span class="kr">type</span> <span class="n">synonym</span> <span class="kt">ChildQuery</span>
</pre></div>
</td></tr></table>

<p>The compiler has noticed that <code class="codehilite"><span class="kt">ChildQuery</span></code>, a type synonym, is partially applied. That's because <code class="codehilite"><span class="kt">Select</span><span class="o">.</span><span class="kt">Query</span></code>, itself a type synonym, takes several arguments as described in the <a href="https://pursuit.purescript.org/packages/purescript-halogen-select/3.0.0/docs/Select#t:Query">module documentation on Pursuit</a>. Let's walk through each one:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">type</span> <span class="kt">ChildQuery</span> <span class="n">o</span> <span class="n">item</span> <span class="ow">=</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Query</span> <span class="n">o</span> <span class="n">item</span>
</pre></div>
</td></tr></table>

<p><code>o</code> is <em>your</em> query type. Remember how you can embed your own queries into <code>Select</code>, and in that way extend the component's functionality? This is how. So we can fill in the first argument:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">type</span> <span class="kt">ChildQuery</span> <span class="n">item</span> <span class="ow">=</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Query</span> <span class="kt">Query</span> <span class="n">item</span>
</pre></div>
</td></tr></table>

<p><code>item</code> is the type of whatever items you want to be selectable. Commonly these are strings, but can also be custom data types. Later on, in the <a href="https://citizennet.github.io/purescript-halogen-select/tutorials/typeahead">typeahead tutorial</a>, we'll see how powerful custom data types can be for rendering purposes. For our simple dropdown we'll simply specialize this to <code class="codehilite"><span class="kt">String</span></code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">type</span> <span class="kt">ChildQuery</span> <span class="ow">=</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Query</span> <span class="kt">Query</span> <span class="kt">String</span>
</pre></div>
</td></tr></table>

<p>Now that <code>Select</code> has been imported and we've updated our <code>ChildQuery</code> and <code>ChildSlot</code> types to support it, we can worry about what to do when we receive a message from the component.</p>
<h3 id="mounting-the-component">Mounting the component<a class="headerlink" href="#mounting-the-component" title="Permanent link">&para;</a></h3>
<p>We're finally ready to mount the <code>Select</code> component. Mounting any component in Halogen requires supplying a slot value, the component itself, the component's input, and the component's handler. We can put together all of these except for the input, which we haven't prepared yet.</p>
<p>Let's stub out our render function in preparation:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Halogen.HTML.Events</span> <span class="k">as</span> <span class="n">HE</span>

<span class="nf">render</span> <span class="ow">::</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentHTML</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="n">m</span>
<span class="nf">render</span> <span class="n">st</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">h1_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;Dropdown&quot;</span> <span class="p">]</span>
  <span class="p">,</span> <span class="kt">HH</span><span class="o">.</span><span class="n">slot</span> <span class="n">unit</span> <span class="kt">Select</span><span class="o">.</span><span class="n">component</span> <span class="o">?</span><span class="n">input</span> <span class="p">(</span><span class="kt">HE</span><span class="o">.</span><span class="n">input</span> <span class="o">&lt;&lt;&lt;</span> <span class="n">const</span> <span class="kt">Nothing</span><span class="p">)</span>
  <span class="p">]</span>
</pre></div>
</td></tr></table>

<p>With that out of the way, we can turn to filling in our component's input type. We can either look at the module documentation for <code>Select.Input</code> or look at the type error that resulted from our typed hole, <code>?input</code>. Both will tell us that we need to provide a value of this type:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">type</span> <span class="kt">Input</span> <span class="n">o</span> <span class="n">item</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="n">inputType</span>     <span class="ow">::</span> <span class="kt">InputType</span>
  <span class="p">,</span> <span class="n">items</span>         <span class="ow">::</span> <span class="kt">Array</span> <span class="n">item</span>
  <span class="p">,</span> <span class="n">initialSearch</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">String</span>
  <span class="p">,</span> <span class="n">debounceTime</span>  <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Milliseconds</span>
  <span class="p">,</span> <span class="n">render</span>        <span class="ow">::</span> <span class="kt">State</span> <span class="n">item</span> <span class="ow">-&gt;</span> <span class="kt">ComponentHTML</span> <span class="n">o</span> <span class="n">item</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Let's build this up, step by step. First, we see we have to provide an <code class="codehilite"><span class="kt">InputType</span></code>. This is described in the module documentation:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">-- | Text-driven inputs will operate like a normal search-driven selection component.</span>
<span class="c1">-- | Toggle-driven inputs will capture key streams and debounce in reverse (only notify</span>
<span class="c1">-- | about searches when time has expired).</span>
<span class="kr">data</span> <span class="kt">InputType</span>
  <span class="ow">=</span> <span class="kt">TextInput</span>
  <span class="o">|</span> <span class="kt">Toggle</span>
</pre></div>
</td></tr></table>

<p>We don't have any text input for our dropdown -- its a button -- so we'll go with the <code class="codehilite"><span class="kt">Toggle</span></code> constructor.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">selectInput</span> <span class="ow">::</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Input</span> <span class="kt">Query</span> <span class="kt">String</span>
<span class="nf">selectInput</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="n">inputType</span><span class="kt">:</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Toggle</span>
  <span class="p">,</span> <span class="o">...</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Next, we're expected to provide an array of items. Fortunately we already have those in our <code class="codehilite"><span class="kt">State</span></code>. We can just send those items directly into the input.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">selectInput</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="o">...</span>
  <span class="p">,</span> <span class="n">items</span><span class="kt">:</span> <span class="n">st</span><span class="o">.</span><span class="n">availableItems</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Next, we're expected to provide an initial search. This would be more useful if we had a text input, but for our dropdown, we'll start off with no initial search.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">selectInput</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="o">...</span>
  <span class="p">,</span> <span class="n">initialSearch</span><span class="kt">:</span> <span class="kt">Nothing</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>What about a debounce time? For toggle-driven components, this is how long to aggregate key presses before the user's typing should affect the list of items. For search-driven components, this is how long to delay before raising a message with the new search. For our dropdown, we don't care:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">selectInput</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="o">...</span>
  <span class="p">,</span> <span class="n">debounceTime</span><span class="kt">:</span> <span class="kt">Nothing</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Finally, we're expected to provide a render function to the component. Ah ha! We've actually already written a render function for a dropdown -- it's just that the type is wrong.</p>
<h3 id="adapting-the-render-function-for-select">Adapting the render function for <code>Select</code><a class="headerlink" href="#adapting-the-render-function-for-select" title="Permanent link">&para;</a></h3>
<p>Let's look at the types side-by-side:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">Select</span><span class="o">.</span><span class="n">render</span> <span class="ow">::</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">State</span> <span class="n">item</span> <span class="ow">-&gt;</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">ComponentHTML</span> <span class="n">o</span> <span class="n">item</span>

<span class="nf">dropdown</span> <span class="ow">::</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentHTML</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="n">m</span>
<span class="nf">dropdown</span> <span class="n">st</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">button_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="o">$</span> <span class="n">fromMaybe</span> <span class="s">&quot;Click me to view some items&quot;</span> <span class="n">st</span><span class="o">.</span><span class="n">selectedItem</span> <span class="p">]</span>
  <span class="p">,</span> <span class="kr">if</span> <span class="n">st</span><span class="o">.</span><span class="n">isOpen</span>
      <span class="kr">then</span> <span class="kt">HH</span><span class="o">.</span><span class="n">ul_</span> <span class="o">$</span> <span class="p">(</span><span class="nf">\</span><span class="n">item</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">li_</span> <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">])</span> <span class="o">&lt;$&gt;</span> <span class="n">st</span><span class="o">.</span><span class="n">availableItems</span>
      <span class="kr">else</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;&quot;</span>
  <span class="p">]</span>
</pre></div>
</td></tr></table>

<p>From this, we can see that we need to use the state type from <code>Select</code> to drive our render function, not the state from our parent component. Will our function still work? Let's look at <a href="https://pursuit.purescript.org/packages/purescript-halogen-select/3.0.0/docs/Select#t:State"><code>Select</code>'s state type in the module documentation</a> to see what we have available:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">type</span> <span class="kt">State</span> <span class="n">item</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="n">inputType</span>        <span class="ow">::</span> <span class="kt">InputType</span>
  <span class="p">,</span> <span class="n">search</span>           <span class="ow">::</span> <span class="kt">String</span>
  <span class="p">,</span> <span class="n">debounceTime</span>     <span class="ow">::</span> <span class="kt">Milliseconds</span>
  <span class="p">,</span> <span class="n">debouncer</span>        <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Debouncer</span>
  <span class="p">,</span> <span class="n">inputElement</span>     <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">HTMLElement</span>
  <span class="p">,</span> <span class="n">items</span>            <span class="ow">::</span> <span class="kt">Array</span> <span class="n">item</span>
  <span class="p">,</span> <span class="n">visibility</span>       <span class="ow">::</span> <span class="kt">Visibility</span>
  <span class="p">,</span> <span class="n">highlightedIndex</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Int</span>
  <span class="p">,</span> <span class="n">lastIndex</span>        <span class="ow">::</span> <span class="kt">Int</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>That's a lot of stuff! We have some of the data we need in <code>Select</code>'s state -- we have our list of items and whether the menu is open or closed. We even got new information, like which item is highlighted. But we're missing something crucial: which item is selected.</p>
<p>As a general rule, <code>Select</code> does not manage selections on your behalf. You are expected to decide what you want to happen when an item is selected and to store the selections yourself.</p>
<p>What can we do? We don't have all the information we need to write this function. Or do we?</p>
<p>In fact, <em>so long as we write the <code>Select</code> render function within the <code>where</code> clause of the parent component's render function</em>, we have access to the parent's state! Let's give it a shot.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">render</span> <span class="n">parentState</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">h1_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;Dropdown&quot;</span> <span class="p">]</span>
  <span class="p">,</span> <span class="kt">HH</span><span class="o">.</span><span class="n">slot</span> <span class="n">unit</span> <span class="kt">Select</span><span class="o">.</span><span class="n">component</span> <span class="o">?</span><span class="n">input</span> <span class="p">(</span><span class="kt">HE</span><span class="o">.</span><span class="n">input</span> <span class="o">&lt;&lt;&lt;</span> <span class="n">const</span> <span class="kt">Nothing</span><span class="p">)</span>
  <span class="p">]</span>
  <span class="kr">where</span>
    <span class="n">dropdown</span>
      <span class="ow">::</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">State</span> <span class="kt">String</span>
      <span class="ow">-&gt;</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">ComponentHTML</span> <span class="kt">Query</span> <span class="kt">String</span>
    <span class="n">dropdown</span> <span class="n">childState</span> <span class="ow">=</span>
      <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
      <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">button_</span>
        <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="o">$</span> <span class="n">fromMaybe</span> <span class="s">&quot;Click me to view some items&quot;</span> <span class="n">parentState</span><span class="o">.</span><span class="n">selectedItem</span> <span class="p">]</span>
      <span class="p">,</span> <span class="kr">if</span> <span class="n">childState</span><span class="o">.</span><span class="n">visibility</span> <span class="o">==</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">On</span>
          <span class="kr">then</span> <span class="kt">HH</span><span class="o">.</span><span class="n">ul_</span> <span class="o">$</span> <span class="p">(</span><span class="nf">\</span><span class="n">item</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">li_</span> <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">])</span> <span class="o">&lt;$&gt;</span> <span class="n">childState</span><span class="o">.</span><span class="n">items</span>
          <span class="kr">else</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;&quot;</span>
      <span class="p">]</span>
</pre></div>
</td></tr></table>

<p>It works! Even better, we no longer have to manage things like <code class="codehilite"><span class="nf">openState</span></code> in the parent anymore. Finally, now that we have the render function we need, we can finally finish our component's input type:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">render</span> <span class="ow">::</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentHTML</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="n">m</span>
<span class="nf">render</span> <span class="n">parentState</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">h1_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;Dropdown&quot;</span> <span class="p">]</span>
  <span class="p">,</span> <span class="kt">HH</span><span class="o">.</span><span class="n">slot</span> <span class="n">unit</span> <span class="kt">Select</span><span class="o">.</span><span class="n">component</span> <span class="n">selectInput</span> <span class="p">(</span><span class="kt">HE</span><span class="o">.</span><span class="n">input</span> <span class="o">&lt;&lt;&lt;</span> <span class="n">const</span> <span class="kt">Nothing</span><span class="p">)</span>
  <span class="p">]</span>
  <span class="kr">where</span>
    <span class="n">selectInput</span> <span class="ow">::</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Input</span> <span class="kt">Query</span> <span class="kt">String</span>
    <span class="n">selectInput</span> <span class="ow">=</span>
      <span class="p">{</span> <span class="n">inputType</span><span class="kt">:</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Toggle</span>
      <span class="p">,</span> <span class="n">items</span><span class="kt">:</span> <span class="n">parentState</span><span class="o">.</span><span class="n">availableItems</span>
      <span class="p">,</span> <span class="n">initialSearch</span><span class="kt">:</span> <span class="kt">Nothing</span>
      <span class="p">,</span> <span class="n">debounceTime</span><span class="kt">:</span> <span class="kt">Nothing</span>
      <span class="p">,</span> <span class="n">render</span><span class="kt">:</span> <span class="n">dropdown</span>
      <span class="p">}</span>

    <span class="n">dropdown</span> <span class="ow">=</span> <span class="o">...</span>
</pre></div>
</td></tr></table>

<h2 id="integrating-behavior">Integrating Behavior<a class="headerlink" href="#integrating-behavior" title="Permanent link">&para;</a></h2>
<p>Everything up to this point has been standard Halogen except for writing the child component's render function. At this point, the <code>Select</code> component is running -- good work! However, it's not yet <em>doing</em> anything.</p>
<p>It's now time to turn your static HTML into a fully-functioning dropdown.</p>
<h3 id="attaching-behavior-to-select">Attaching behavior to Select<a class="headerlink" href="#attaching-behavior-to-select" title="Permanent link">&para;</a></h3>
<p><code>Select</code> works by using a few helper functions that attach at critical points in your render function. The library assumes very little about what your rendering looks like, except that there <em>at least</em> exists:</p>
<ul>
<li>One or more items that can be selected</li>
<li>An element that contains those items</li>
<li>A focusable element that can be used to toggle visibility and capture keystrokes</li>
</ul>
<p>Accordingly, you'll need to use three helper functions, each exported by the <code>Select.Setters</code> module:</p>
<ul>
<li><code>setItemProps</code></li>
<li><code>setContainerProps</code></li>
<li><code>setToggleProps</code> (for toggle-driven input)</li>
<li><code>setInputProps</code> (for text-driven input)</li>
</ul>
<p>Each of these functions should be used on the property array for the relevant element in your HTML. Let's walk through each one using our built render function.</p>
<p>First, let's augment our individual items. <code class="codehilite"><span class="nf">setItemProps</span></code> takes an index and some properties and outputs some new properties, which include all sorts of event handlers necessary for keyboard events and click events to work. In order to provide it with the index it needs, we'll use the <code class="codehilite"><span class="nf">mapWithIndex</span></code> function from <code class="codehilite"><span class="kt">Data</span><span class="o">.</span><span class="kt">Array</span></code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Data.Array</span> <span class="p">(</span><span class="nf">mapWithIndex</span><span class="p">)</span>

<span class="nf">dropdown</span> <span class="n">childState</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">button_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="o">$</span> <span class="n">fromMaybe</span> <span class="s">&quot;Click me to view some items&quot;</span> <span class="n">parentState</span><span class="o">.</span><span class="n">selectedItem</span> <span class="p">]</span>
  <span class="p">,</span> <span class="kr">case</span> <span class="n">childState</span><span class="o">.</span><span class="n">visibility</span> <span class="kr">of</span>
      <span class="kt">Select</span><span class="o">.</span><span class="kt">Off</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;&quot;</span>

      <span class="kt">Select</span><span class="o">.</span><span class="kt">On</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">ul</span> <span class="kt">[]</span> <span class="o">$</span>
        <span class="n">mapWithIndex</span>
          <span class="p">(</span><span class="nf">\</span><span class="n">ix</span> <span class="n">item</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">li</span> <span class="p">(</span><span class="kt">Setters</span><span class="o">.</span><span class="n">setItemProps</span> <span class="n">ix</span> <span class="kt">[]</span><span class="p">)</span> <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">])</span>
          <span class="n">childState</span><span class="o">.</span><span class="n">items</span>
  <span class="p">]</span>
</pre></div>
</td></tr></table>

<p>Next, we'll move to the element that contains the items. The <code class="codehilite"><span class="nf">setContainerProps</span></code> function takes and returns some properties, attaching all the behavior the library needs. We'll use this on the parent element, <code>ul</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">dropdown</span> <span class="n">childState</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">button_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="o">$</span> <span class="n">fromMaybe</span> <span class="s">&quot;Click me to view some items&quot;</span> <span class="n">parentState</span><span class="o">.</span><span class="n">selectedItem</span> <span class="p">]</span>
  <span class="p">,</span> <span class="kr">case</span> <span class="n">childState</span><span class="o">.</span><span class="n">visibility</span> <span class="kr">of</span>
      <span class="kt">Select</span><span class="o">.</span><span class="kt">Off</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;&quot;</span>

      <span class="kt">Select</span><span class="o">.</span><span class="kt">On</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">ul</span> <span class="p">(</span><span class="kt">Setters</span><span class="o">.</span><span class="n">setContainerProps</span> <span class="kt">[]</span><span class="p">)</span> <span class="o">$</span>
        <span class="n">mapWithIndex</span>
          <span class="p">(</span><span class="nf">\</span><span class="n">ix</span> <span class="n">item</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">li</span> <span class="p">(</span><span class="kt">Setters</span><span class="o">.</span><span class="n">setItemProps</span> <span class="n">ix</span> <span class="kt">[]</span><span class="p">)</span> <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">])</span>
          <span class="n">childState</span><span class="o">.</span><span class="n">items</span>
  <span class="p">]</span>
</pre></div>
</td></tr></table>

<p>Finally, we can make sure that our button toggles the menu on and off, captures keyboard events, can be tabbed to, and all sorts of other stuff with the <code class="codehilite"><span class="nf">setToggleProps</span></code> function.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">dropdown</span> <span class="n">childState</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">button</span>
    <span class="p">(</span><span class="kt">Setters</span><span class="o">.</span><span class="n">setToggleProps</span> <span class="kt">[]</span><span class="p">)</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="o">$</span> <span class="n">fromMaybe</span> <span class="s">&quot;Click me to view some items&quot;</span> <span class="n">parentState</span><span class="o">.</span><span class="n">selectedItem</span> <span class="p">]</span>
  <span class="p">,</span> <span class="kr">case</span> <span class="n">childState</span><span class="o">.</span><span class="n">visibility</span> <span class="kr">of</span>
      <span class="kt">Select</span><span class="o">.</span><span class="kt">Off</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;&quot;</span>

      <span class="kt">Select</span><span class="o">.</span><span class="kt">On</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">ul</span> <span class="kt">[]</span> <span class="o">$</span>
        <span class="n">mapWithIndex</span>
          <span class="p">(</span><span class="nf">\</span><span class="n">ix</span> <span class="n">item</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">li</span> <span class="p">(</span><span class="kt">Setters</span><span class="o">.</span><span class="n">setItemProps</span> <span class="n">ix</span> <span class="kt">[]</span><span class="p">)</span> <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">])</span>
          <span class="n">childState</span><span class="o">.</span><span class="n">items</span>
  <span class="p">]</span>
</pre></div>
</td></tr></table>

<p>Whew! Your rendering code now contains everything it needs to provide a keyboard-accessible dropdown. If you open this up in the browser and click around, you'll notice it's properly toggling and can be tabbed to.</p>
<p>Let's make one last improvement. When you use your arrow keys on the dropdown, the highlighted index is changing, but since we didn't provide any CSS we can't see it. Let's add some bare-bones styling so we can watch the highlights:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Halogen.HTML.Properties</span> <span class="k">as</span> <span class="n">HP</span>

<span class="kt">Select</span><span class="o">.</span><span class="kt">On</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">ul</span> <span class="p">(</span><span class="kt">Setters</span><span class="o">.</span><span class="n">setContainerProps</span> <span class="kt">[]</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">mapWithIndex</span>
    <span class="p">(</span><span class="nf">\</span><span class="n">ix</span> <span class="n">item</span> <span class="ow">-&gt;</span>
      <span class="kt">HH</span><span class="o">.</span><span class="n">li</span>
        <span class="p">(</span> <span class="kt">Setters</span><span class="o">.</span><span class="n">setItemProps</span> <span class="n">ix</span>
          <span class="o">$</span> <span class="kr">case</span> <span class="kt">Just</span> <span class="n">ix</span> <span class="o">==</span> <span class="n">childState</span><span class="o">.</span><span class="n">highlightedIndex</span> <span class="kr">of</span>
              <span class="n">true</span> <span class="ow">-&gt;</span> <span class="p">[</span> <span class="kt">HP</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="kt">HH</span><span class="o">.</span><span class="kt">AttrName</span> <span class="s">&quot;style&quot;</span><span class="p">)</span> <span class="s">&quot;color: red;&quot;</span> <span class="p">]</span>
              <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="kt">[]</span> <span class="p">)</span>
        <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">childState</span><span class="o">.</span><span class="n">items</span>
</pre></div>
</td></tr></table>

<p>There we go! Try toggling the menu on and off, using your arrow, enter, and escape keys, and so on. It works!</p>
<p>...almost. Alas, we aren't doing anything when the user makes a selection. <code>Select</code> is attempting to notify us that a selection occurred, but we never provided a handler. Let's fix that now.</p>
<h3 id="handling-messages-from-select">Handling messages from Select<a class="headerlink" href="#handling-messages-from-select" title="Permanent link">&para;</a></h3>
<p>When you add a new child component you invariably need to add a handler for its <code class="codehilite"><span class="kt">Message</span></code> type. What should the parent do when something important has occurred in the child? To handle messages, add a new constructor to your query algebra that takes the child's <code class="codehilite"><span class="kt">Message</span></code> type as an argument:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Query</span> <span class="n">a</span>
  <span class="ow">=</span> <span class="kt">NoOp</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">HandleSelect</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Message</span> <span class="n">a</span>
</pre></div>
</td></tr></table>

<p>Ah -- this won't compile!</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">Error</span> <span class="n">found</span> <span class="kr">in</span> <span class="kr">module</span> <span class="nn">Component</span><span class="kt">:</span>

  <span class="kt">Could</span> <span class="n">not</span> <span class="n">match</span> <span class="n">kind</span>
    <span class="p">(</span><span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span>

  <span class="n">with</span> <span class="n">kind</span>
    <span class="kt">Type</span>

<span class="kr">in</span> <span class="kr">type</span> <span class="n">constructor</span> <span class="kt">Query</span>
</pre></div>
</td></tr></table>

<p>This looks similar to the type error we got when we tried to just use <code>Select.Query</code> in a type synonym. We need to provide a <code class="codehilite"><span class="kt">Type</span></code> to <code class="codehilite"><span class="kt">HandleSelect</span></code>, but <code class="codehilite"><span class="kt">Select</span><span class="o">.</span><span class="kt">Message</span></code> is still awaiting 2 arguments, the first of which is <em>itself</em> awaiting an argument! Let's go look at the <a href="https://pursuit.purescript.org/packages/purescript-halogen-select/3.0.0/docs/Select#t:Message">module documentation for <code>Select.Message</code></a>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Message</span> <span class="n">o</span> <span class="n">item</span>
</pre></div>
</td></tr></table>

<p>We've seen both of these arguments before in the component's query type, so we should fill them in with the same values. <code>o</code> is our parent component query type, and <code>item</code> is a <code class="codehilite"><span class="kt">String</span></code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Query</span> <span class="n">a</span>
  <span class="ow">=</span> <span class="kt">NoOp</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">HandleSelect</span> <span class="p">(</span><span class="kt">Select</span><span class="o">.</span><span class="kt">Message</span> <span class="kt">Query</span> <span class="kt">String</span><span class="p">)</span> <span class="n">a</span>
</pre></div>
</td></tr></table>

<p>As soon as you save and rebuild you'll see another compiler error!</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">Error</span> <span class="n">found</span> <span class="kr">in</span> <span class="kr">module</span> <span class="nn">Component</span>

  <span class="kt">A</span> <span class="kr">case</span> <span class="n">expression</span> <span class="n">could</span> <span class="n">not</span> <span class="n">be</span> <span class="n">determined</span> <span class="n">to</span> <span class="n">cover</span> <span class="n">all</span> <span class="n">inputs</span><span class="o">.</span>
  <span class="kt">The</span> <span class="n">following</span> <span class="n">additional</span> <span class="n">cases</span> <span class="n">are</span> <span class="n">required</span> <span class="n">to</span> <span class="n">cover</span> <span class="n">all</span> <span class="n">inputs</span><span class="kt">:</span>

    <span class="p">(</span><span class="kt">HandleSelect</span> <span class="kr">_</span> <span class="kr">_</span><span class="p">)</span>

<span class="kr">in</span> <span class="n">value</span> <span class="n">declaration</span> <span class="n">component</span>
</pre></div>
</td></tr></table>

<p>This time it's because we've added a new query, but we never updated our <code class="codehilite"><span class="nf">eval</span></code> function to describe what should happen when the query is triggered. What should we actually <em>do</em> when a message comes up from the child component?</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You'll often see type errors that end in "... value declaration component." when the error occurred in any of the functions in the <code>where</code> clause for the component. It can be annoying to track down where the error actually is in your code. One way to help track these down is to move your code out of the <code>where</code> block and into the module level temporarily so the compiler can identify which particular function is causing the issue.</p>
</div>
<p>There are four possible sub-cases that we need to handle, each described in the module documentation:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Message</span> <span class="n">o</span> <span class="n">item</span>
  <span class="ow">=</span> <span class="kt">Searched</span> <span class="kt">String</span>
  <span class="o">|</span> <span class="kt">Selected</span> <span class="n">item</span>
  <span class="o">|</span> <span class="kt">VisibilityChanged</span> <span class="kt">Visibility</span>
  <span class="o">|</span> <span class="kt">Emit</span> <span class="p">(</span><span class="n">o</span> <span class="kt">Unit</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Let's stub out each of these cases and then decide what to do with them:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">eval</span> <span class="ow">::</span> <span class="kt">Query</span> <span class="o">~&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentDSL</span> <span class="kt">State</span> <span class="kt">Query</span> <span class="p">(</span><span class="kt">ChildQuery</span> <span class="n">eff</span><span class="p">)</span> <span class="kt">ChildSlot</span> <span class="kt">Message</span> <span class="n">m</span>
<span class="nf">eval</span> <span class="ow">=</span> <span class="kr">case</span> <span class="kr">_</span> <span class="kr">of</span>
  <span class="kt">NoOp</span> <span class="n">next</span> <span class="ow">-&gt;</span> <span class="n">pure</span> <span class="n">next</span>

  <span class="kt">HandleSelect</span> <span class="n">message</span> <span class="n">next</span> <span class="ow">-&gt;</span> <span class="kr">case</span> <span class="n">message</span> <span class="kr">of</span>
    <span class="kt">Select</span><span class="o">.</span><span class="kt">Searched</span> <span class="n">string</span> <span class="ow">-&gt;</span>
      <span class="n">pure</span> <span class="n">next</span>

    <span class="kt">Select</span><span class="o">.</span><span class="kt">Selected</span> <span class="n">item</span> <span class="ow">-&gt;</span>
      <span class="n">pure</span> <span class="n">next</span>

    <span class="kt">Select</span><span class="o">.</span><span class="kt">VisibilityChanged</span> <span class="n">vis</span> <span class="ow">-&gt;</span>
      <span class="n">pure</span> <span class="n">next</span>

    <span class="kt">Select</span><span class="o">.</span><span class="kt">Emit</span> <span class="n">query</span> <span class="ow">-&gt;</span>
      <span class="n">pure</span> <span class="n">next</span>
</pre></div>
</td></tr></table>

<p>Let's take these case-by-case.</p>
<p>What should we do when the user has searched something on our dropdown? This is just a simple list of items, so we'll simply ignore their search. We can leave this as <code class="codehilite"><span class="nf">pure</span> <span class="n">next</span></code>.</p>
<p>What should we do when the user has selected an item? Ah! This is more interesting. We want to set their item as the currently-selected one, and then we want to remove it from the available items list. Once we've removed it from the available items, we'll update <code>Select</code> with its new items to display and we'll toggle it off.</p>
<p>We can use <code class="codehilite"><span class="nf">difference</span></code> from <code class="codehilite"><span class="kt">Data</span><span class="o">.</span><span class="kt">Array</span></code> to filter out the selected item from the overall list of items. This is a common pattern in <code>Select</code>: the parent holds the immutable list of all possible items, and <code>Select</code> receives some subset of those items at each render. You might use the user's search to filter out items in a typeahead, for example, or only load 50 results at a time into a dropdown.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Data.Array</span> <span class="p">(</span><span class="nf">difference</span><span class="p">)</span>

<span class="kt">Select</span><span class="o">.</span><span class="kt">Selected</span> <span class="n">item</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
  <span class="n">st</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">get</span>
  <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">query</span> <span class="n">unit</span> <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">setVisibility</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Off</span>
  <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">query</span> <span class="n">unit</span> <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">replaceItems</span> <span class="o">$</span> <span class="n">difference</span> <span class="n">st</span><span class="o">.</span><span class="n">availableItems</span> <span class="p">[</span> <span class="n">item</span> <span class="p">]</span>
  <span class="kt">H</span><span class="o">.</span><span class="n">modify</span> <span class="kr">_</span> <span class="p">{</span> <span class="n">selectedItem</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="n">item</span> <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>What should we do when the dropdown's visibility has changed? This can often be useful to run validation, but for our dropdown, we don't care what its visibility is. We can leave this as <code class="codehilite"><span class="nf">pure</span> <span class="n">next</span></code>.</p>
<p>Finally, what should we do when the child component raises its <code>Emit</code> message? What does this even mean? <code>Emit</code> exists so you can embed your own queries into <code>Select</code> and extend its behavior. Since the message contains one of your own queries, all you have to do is evaluate it: you can call <code>eval</code> recursively to run your query.</p>
<p>You can think of <code>Emit</code> as notifying you that the query you embedded is ready to run.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">Select</span><span class="o">.</span><span class="kt">Emit</span> <span class="n">query</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
  <span class="n">eval</span> <span class="n">query</span>
  <span class="n">pure</span> <span class="n">next</span>
</pre></div>
</td></tr></table>

<p>Nice and simple! While you may write all kinds of logic for the other messages raised by <code>Select</code>, you'll always write this same code for the <code>Emit</code> message.</p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>Congratulations! You have successfully built a keyboard-navigable dropdown using <code>Select</code>. You integrated the library, wrote your own render function, and then augmented it with helper functions from the library. Then, you handled the output messages and sent queries to update the component's state. You've done quite a lot of work!</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Did you notice anything you would improve about this tutorial or the <code>Select</code> library? I'd love to hear about it! Feel free to reach out on the <a href="https://functionalprogramming.slack.com/">functional programming Slack</a> or on the <a href="https://discourse.purescript.org">PureScript user forum</a>. If you found a bug or would like to make an improvement, please open an issue or pull request on the library.</p>
</div>
<h3 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h3>
<p>This tutorial was a slow, thorough introduction to the <code>Select</code> library. But we've only scratched the surface of what you can do with it. I'd recommend continuing on to the faster-paced and more advanced <a href="https://citizennet.github.io/purescript-halogen-select/tutorials/typeahead">typeahead tutorial</a>.</p>
<h3 id="source-code">Source Code<a class="headerlink" href="#source-code" title="Permanent link">&para;</a></h3>
<p>If you'd like to use this component as a starting point from which to build your own, feel free to copy/paste the source code below.</p>
<details class="article"><summary>Full source code for the tutorial</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">module</span> <span class="nn">Component</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Prelude</span>

<span class="kr">import</span> <span class="nn">Effect.Aff.Class</span> <span class="p">(</span><span class="nf">class</span> <span class="kt">MonadAff</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.Array</span> <span class="p">(</span><span class="nf">difference</span><span class="p">,</span> <span class="nf">mapWithIndex</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.Maybe</span> <span class="p">(</span><span class="kt">Maybe</span><span class="p">(</span><span class="o">..</span><span class="p">),</span> <span class="nf">fromMaybe</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Halogen</span> <span class="k">as</span> <span class="n">H</span>
<span class="kr">import</span> <span class="nn">Halogen.HTML</span> <span class="k">as</span> <span class="n">HH</span>
<span class="kr">import</span> <span class="nn">Halogen.HTML.Events</span> <span class="k">as</span> <span class="n">HE</span>
<span class="kr">import</span> <span class="nn">Halogen.HTML.Properties</span> <span class="k">as</span> <span class="n">HP</span>
<span class="kr">import</span> <span class="nn">Select</span> <span class="k">as</span> <span class="n">Select</span>
<span class="kr">import</span> <span class="nn">Select.Setters</span> <span class="k">as</span> <span class="n">Setters</span>

<span class="kr">data</span> <span class="kt">Query</span> <span class="n">a</span>
  <span class="ow">=</span> <span class="kt">HandleSelect</span> <span class="p">(</span><span class="kt">Select</span><span class="o">.</span><span class="kt">Message</span> <span class="kt">Query</span> <span class="kt">String</span><span class="p">)</span> <span class="n">a</span>

<span class="kr">type</span> <span class="kt">State</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="n">isOpen</span> <span class="ow">::</span> <span class="kt">Boolean</span>
  <span class="p">,</span> <span class="n">selectedItem</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">String</span>
  <span class="p">,</span> <span class="n">availableItems</span> <span class="ow">::</span> <span class="kt">Array</span> <span class="kt">String</span>
  <span class="p">}</span>

<span class="kr">type</span> <span class="kt">Input</span> <span class="ow">=</span> <span class="kt">Unit</span>

<span class="kr">type</span> <span class="kt">Message</span> <span class="ow">=</span> <span class="kt">Void</span>

<span class="kr">type</span> <span class="kt">ChildSlot</span> <span class="ow">=</span> <span class="kt">Unit</span>
<span class="kr">type</span> <span class="kt">ChildQuery</span> <span class="ow">=</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Query</span> <span class="kt">Query</span> <span class="kt">String</span>

<span class="nf">component</span> <span class="ow">::</span> <span class="err">∀</span> <span class="n">m</span><span class="o">.</span> <span class="kt">MonadAff</span> <span class="n">m</span> <span class="ow">=&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">Component</span> <span class="kt">HH</span><span class="o">.</span><span class="kt">HTML</span> <span class="kt">Query</span> <span class="kt">Input</span> <span class="kt">Message</span> <span class="n">m</span>
<span class="nf">component</span> <span class="ow">=</span>
  <span class="kt">H</span><span class="o">.</span><span class="n">parentComponent</span>
    <span class="p">{</span> <span class="n">initialState</span>
    <span class="p">,</span> <span class="n">render</span>
    <span class="p">,</span> <span class="n">eval</span>
    <span class="p">,</span> <span class="n">receiver</span><span class="kt">:</span> <span class="n">const</span> <span class="kt">Nothing</span>
    <span class="p">}</span>
  <span class="kr">where</span>

  <span class="n">initialState</span> <span class="ow">::</span> <span class="kt">Input</span> <span class="ow">-&gt;</span> <span class="kt">State</span>
  <span class="n">initialState</span> <span class="ow">=</span> <span class="n">const</span>
    <span class="p">{</span> <span class="n">isOpen</span><span class="kt">:</span> <span class="n">false</span>
    <span class="p">,</span> <span class="n">selectedItem</span><span class="kt">:</span> <span class="kt">Nothing</span>
    <span class="p">,</span> <span class="n">availableItems</span><span class="kt">:</span>
        <span class="p">[</span> <span class="s">&quot;Item One&quot;</span>
        <span class="p">,</span> <span class="s">&quot;Item Two&quot;</span>
        <span class="p">,</span> <span class="s">&quot;Item Three&quot;</span>
        <span class="p">]</span>
    <span class="p">}</span>

  <span class="n">render</span> <span class="ow">::</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentHTML</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="n">m</span>
  <span class="n">render</span> <span class="n">parentState</span> <span class="ow">=</span>
    <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">h1_</span>
      <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;Dropdown&quot;</span> <span class="p">]</span>
    <span class="p">,</span> <span class="kt">HH</span><span class="o">.</span><span class="n">slot</span> <span class="n">unit</span> <span class="kt">Select</span><span class="o">.</span><span class="n">component</span> <span class="n">selectInput</span> <span class="p">(</span><span class="kt">HE</span><span class="o">.</span><span class="n">input</span> <span class="kt">HandleSelect</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="kr">where</span>
      <span class="n">selectInput</span> <span class="ow">::</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Input</span> <span class="kt">Query</span> <span class="kt">String</span>
      <span class="n">selectInput</span> <span class="ow">=</span>
        <span class="p">{</span> <span class="n">inputType</span><span class="kt">:</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Toggle</span>
        <span class="p">,</span> <span class="n">items</span><span class="kt">:</span> <span class="n">parentState</span><span class="o">.</span><span class="n">availableItems</span>
        <span class="p">,</span> <span class="n">initialSearch</span><span class="kt">:</span> <span class="kt">Nothing</span>
        <span class="p">,</span> <span class="n">debounceTime</span><span class="kt">:</span> <span class="kt">Nothing</span>
        <span class="p">,</span> <span class="n">render</span><span class="kt">:</span> <span class="n">dropdown</span>
        <span class="p">}</span>

      <span class="n">dropdown</span>
        <span class="ow">::</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">State</span> <span class="kt">String</span>
        <span class="ow">-&gt;</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">ComponentHTML</span> <span class="kt">Query</span> <span class="kt">String</span>
      <span class="n">dropdown</span> <span class="n">childState</span> <span class="ow">=</span>
        <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
        <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">button</span>
          <span class="p">(</span><span class="kt">Setters</span><span class="o">.</span><span class="n">setToggleProps</span> <span class="kt">[]</span><span class="p">)</span>
          <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="o">$</span> <span class="n">fromMaybe</span> <span class="s">&quot;Click me to view some items&quot;</span> <span class="n">parentState</span><span class="o">.</span><span class="n">selectedItem</span> <span class="p">]</span>
        <span class="p">,</span> <span class="kr">case</span> <span class="n">childState</span><span class="o">.</span><span class="n">visibility</span> <span class="kr">of</span>
            <span class="kt">Select</span><span class="o">.</span><span class="kt">Off</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;&quot;</span>

            <span class="kt">Select</span><span class="o">.</span><span class="kt">On</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">ul</span> <span class="p">(</span><span class="kt">Setters</span><span class="o">.</span><span class="n">setContainerProps</span> <span class="kt">[]</span><span class="p">)</span> <span class="o">$</span>
              <span class="n">mapWithIndex</span>
                <span class="p">(</span><span class="nf">\</span><span class="n">ix</span> <span class="n">item</span> <span class="ow">-&gt;</span>
                  <span class="kt">HH</span><span class="o">.</span><span class="n">li</span>
                    <span class="p">(</span> <span class="kt">Setters</span><span class="o">.</span><span class="n">setItemProps</span> <span class="n">ix</span>
                      <span class="o">$</span> <span class="kr">case</span> <span class="kt">Just</span> <span class="n">ix</span> <span class="o">==</span> <span class="n">childState</span><span class="o">.</span><span class="n">highlightedIndex</span> <span class="kr">of</span>
                          <span class="n">true</span> <span class="ow">-&gt;</span> <span class="p">[</span> <span class="kt">HP</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="kt">HH</span><span class="o">.</span><span class="kt">AttrName</span> <span class="s">&quot;style&quot;</span><span class="p">)</span> <span class="s">&quot;color: red;&quot;</span> <span class="p">]</span>
                          <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="kt">[]</span> <span class="p">)</span>
                    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">childState</span><span class="o">.</span><span class="n">items</span>
        <span class="p">]</span>

  <span class="n">eval</span> <span class="ow">::</span> <span class="kt">Query</span> <span class="o">~&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentDSL</span> <span class="kt">State</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="kt">Message</span> <span class="n">m</span>
  <span class="n">eval</span> <span class="ow">=</span> <span class="kr">case</span> <span class="kr">_</span> <span class="kr">of</span>
    <span class="kt">HandleSelect</span> <span class="n">message</span> <span class="n">next</span> <span class="ow">-&gt;</span> <span class="kr">case</span> <span class="n">message</span> <span class="kr">of</span>
      <span class="kt">Select</span><span class="o">.</span><span class="kt">Searched</span> <span class="n">string</span> <span class="ow">-&gt;</span>
        <span class="n">pure</span> <span class="n">next</span>

      <span class="kt">Select</span><span class="o">.</span><span class="kt">Selected</span> <span class="n">item</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
        <span class="n">st</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">get</span>
        <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">query</span> <span class="n">unit</span> <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">setVisibility</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Off</span>
        <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">query</span> <span class="n">unit</span> <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">replaceItems</span> <span class="o">$</span> <span class="n">difference</span> <span class="n">st</span><span class="o">.</span><span class="n">availableItems</span> <span class="p">[</span> <span class="n">item</span> <span class="p">]</span>
        <span class="kt">H</span><span class="o">.</span><span class="n">modify</span> <span class="kr">_</span> <span class="p">{</span> <span class="n">selectedItem</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="n">item</span> <span class="p">}</span>
        <span class="n">pure</span> <span class="n">next</span>

      <span class="kt">Select</span><span class="o">.</span><span class="kt">VisibilityChanged</span> <span class="n">vis</span> <span class="ow">-&gt;</span>
        <span class="n">pure</span> <span class="n">next</span>

      <span class="kt">Select</span><span class="o">.</span><span class="kt">Emit</span> <span class="n">query</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
        <span class="n">eval</span> <span class="n">query</span>
        <span class="n">pure</span> <span class="n">next</span>
</pre></div>
</td></tr></table>

</details>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../getting-started/" title="Project setup" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Project setup
              </span>
            </div>
          </a>
        
        
          <a href="../typeahead/" title="Build a typeahead" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Build a typeahead
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 CitizenNet
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../js/app.js"></script>
      
    
  </body>
</html>