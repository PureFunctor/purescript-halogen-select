



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Building blocks for common selection user interfaces in PureScript & Halogen">
      
      
        <link rel="canonical" href="https://citizennet.github.io/purescript-halogen-select/tutorials/typeahead/">
      
      
        <meta name="author" content="Thomas Honeyman">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Build a PureScript Typeahead (Autocomplete) in Halogen</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#00bcd4">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Open Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/Select.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="cyan" data-md-color-accent="cyan">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#lets-build-a-typeahead-in-purescript" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://citizennet.github.io/purescript-halogen-select" title="Select Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Select Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Build a PureScript Typeahead (Autocomplete) in Halogen
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/citizennet/purescript-halogen-select/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    purescript-halogen-select
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://citizennet.github.io/purescript-halogen-select" title="Select Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    Select Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/citizennet/purescript-halogen-select/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    purescript-halogen-select
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../getting-started/" title="Project setup" class="md-nav__link">
      Project setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dropdown/" title="Build a dropdown" class="md-nav__link">
      Build a dropdown
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Build a typeahead
      </label>
    
    <a href="./" title="Build a typeahead" class="md-nav__link md-nav__link--active">
      Build a typeahead
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-setup" class="md-nav__link">
    Basic Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-dependencies" class="md-nav__link">
    Install dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integrate-the-component" class="md-nav__link">
    Integrate the component
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-minimal-typeahead" class="md-nav__link">
    A minimal typeahead
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state" class="md-nav__link">
    State
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query" class="md-nav__link">
    Query
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remove" class="md-nav__link">
    Remove
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emit" class="md-nav__link">
    Emit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visibilitychange" class="md-nav__link">
    VisibilityChange
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selected" class="md-nav__link">
    Selected
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#searched" class="md-nav__link">
    Searched
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rendering" class="md-nav__link">
    Rendering
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-code" class="md-nav__link">
    Source Code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      How To
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        How To
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../how-to/embed-parent-queries/" title="How to embed parent queries" class="md-nav__link">
      How to embed parent queries
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Concepts
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Concepts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../concepts/understanding-free-queries/" title="Understanding free queries" class="md-nav__link">
      Understanding free queries
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../examples/" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-setup" class="md-nav__link">
    Basic Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-dependencies" class="md-nav__link">
    Install dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integrate-the-component" class="md-nav__link">
    Integrate the component
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-minimal-typeahead" class="md-nav__link">
    A minimal typeahead
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state" class="md-nav__link">
    State
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query" class="md-nav__link">
    Query
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remove" class="md-nav__link">
    Remove
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emit" class="md-nav__link">
    Emit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visibilitychange" class="md-nav__link">
    VisibilityChange
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selected" class="md-nav__link">
    Selected
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#searched" class="md-nav__link">
    Searched
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rendering" class="md-nav__link">
    Rendering
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-code" class="md-nav__link">
    Source Code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/citizennet/purescript-halogen-select/edit/master/docs/tutorials/typeahead.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="lets-build-a-typeahead-in-purescript">Let's Build a Typeahead in PureScript!<a class="headerlink" href="#lets-build-a-typeahead-in-purescript" title="Permanent link">&para;</a></h1>
<p>Typeaheads are among the most common selection components you'll build. Most web developers have had to implement at least one of these before and they can be surprisingly difficult to build. Luckily, with <code>Select</code>, implementing a typeahead that fits your custom design takes little more than writing the rendering code and then tweaking it with a helper function or two.</p>
<p>In this tutorial we'll build a typeahead with the following features:</p>
<ul>
<li>Users can search Star Wars characters by name; their searches will be debounced automatically and results will be fetched asynchronously.</li>
<li>The typeahead should support keyboard-only use: arrow keys should step up and down the items, Enter should select, Escape should close, and so on.</li>
<li>The typeahead should manage its own selections, including insertion and removal, and should notify its parent when the selections have changed.</li>
<li>If a search returns no results, then there should be an embedded "fetch data" button the user can click to force a request with an empty search. It should display within the list of items.</li>
</ul>
<p>Along the way, we'll see how to extend <code>Select</code>'s features by embedding parent queries (we'll use this to embed the "fetch data" button in the list).</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This tutorial assumes you've followed the steps in the <a href="https://citizennet.github.io/purescript-halogen-select/tutorials/getting-started/">Project Setup</a> section. While not necessary, this code is tested with those steps in mind.</p>
<p>It also assumes familiarity with Halogen and intermediate PureScript experience or that you have already completed the <a href="https://citizennet.github.io/purescript-halogen-select/tutorials/dropdown">more thorough, beginner-friendly dropdown tutorial</a>. If you need a Halogen refresher, try the official <a href="https://github.com/slamdata/purescript-halogen/tree/master/docs">Halogen guide</a> or the <a href="https://citizennet.github.io/purescript-halogen-select/tutorials/getting-started/#a-whirlwind-tour-of-our-starter-component">whirlwind tour</a> of our starter component.</p>
<p>Your code should work at the end of every step. If you run into issues or your code doesn't compile, please come visit us on the <a href="https://discourse.purescript.org">PureScript user forum</a> or the <a href="https://functionalprogramming.slack.com">#fpchat Slack channel</a>.</p>
</div>
<h2 id="basic-setup">Basic Setup<a class="headerlink" href="#basic-setup" title="Permanent link">&para;</a></h2>
<p>In this tutorial, we'll build a typeahead component from scratch. You can either follow along using the minimal component from the <a href="https://github.citizennet.io/purescript-halogen-select/tutorials/getting-started">Project Setup section</a> or start your own.</p>
<p>If you didn't follow the project setup, grab the source for our starting component here:</p>
<details class="article"><summary>Source code for a minimal starting component</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">module</span> <span class="nn">Component</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Prelude</span>

<span class="kr">import</span> <span class="nn">Effect.Aff.Class</span> <span class="p">(</span><span class="nf">class</span> <span class="kt">MonadAff</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.Const</span> <span class="p">(</span><span class="kt">Const</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.Maybe</span> <span class="p">(</span><span class="kt">Maybe</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">Halogen</span> <span class="k">as</span> <span class="n">H</span>
<span class="kr">import</span> <span class="nn">Halogen.HTML</span> <span class="k">as</span> <span class="n">HH</span>

<span class="kr">data</span> <span class="kt">Query</span> <span class="n">a</span>
  <span class="ow">=</span> <span class="kt">NoOp</span> <span class="n">a</span>

<span class="kr">type</span> <span class="kt">State</span> <span class="ow">=</span> <span class="kt">Unit</span>
<span class="kr">type</span> <span class="kt">Input</span> <span class="ow">=</span> <span class="kt">Unit</span>

<span class="kr">type</span> <span class="kt">Message</span> <span class="ow">=</span> <span class="kt">Void</span>

<span class="kr">type</span> <span class="kt">ChildSlot</span> <span class="ow">=</span> <span class="kt">Unit</span>
<span class="kr">type</span> <span class="kt">ChildQuery</span> <span class="ow">=</span> <span class="kt">Const</span> <span class="kt">Void</span>

<span class="nf">component</span> <span class="ow">::</span> <span class="err">∀</span> <span class="n">m</span><span class="o">.</span> <span class="kt">MonadAff</span> <span class="n">m</span> <span class="ow">=&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">Component</span> <span class="kt">HH</span><span class="o">.</span><span class="kt">HTML</span> <span class="kt">Query</span> <span class="kt">Input</span> <span class="kt">Message</span> <span class="n">m</span>
<span class="nf">component</span> <span class="ow">=</span>
  <span class="kt">H</span><span class="o">.</span><span class="n">parentComponent</span>
    <span class="p">{</span> <span class="n">initialState</span>
    <span class="p">,</span> <span class="n">render</span>
    <span class="p">,</span> <span class="n">eval</span>
    <span class="p">,</span> <span class="n">receiver</span><span class="kt">:</span> <span class="n">const</span> <span class="kt">Nothing</span>
    <span class="p">}</span>
  <span class="kr">where</span>

  <span class="n">initialState</span> <span class="ow">::</span> <span class="kt">Input</span> <span class="ow">-&gt;</span> <span class="kt">State</span>
  <span class="n">initialState</span> <span class="ow">=</span> <span class="n">const</span> <span class="n">unit</span>

  <span class="n">render</span> <span class="ow">::</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentHTML</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="n">m</span>
  <span class="n">render</span> <span class="n">st</span> <span class="ow">=</span> <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span> <span class="kt">[]</span>

  <span class="n">eval</span> <span class="ow">::</span> <span class="kt">Query</span> <span class="o">~&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentDSL</span> <span class="kt">State</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="kt">Message</span> <span class="n">m</span>
  <span class="n">eval</span> <span class="ow">=</span> <span class="kr">case</span> <span class="kr">_</span> <span class="kr">of</span>
    <span class="kt">NoOp</span> <span class="n">next</span> <span class="ow">-&gt;</span> <span class="n">pure</span> <span class="n">next</span>
</pre></div>
</td></tr></table>

</details>
<h3 id="install-dependencies">Install dependencies<a class="headerlink" href="#install-dependencies" title="Permanent link">&para;</a></h3>
<p>The first thing we'll do is make sure we have the libraries we need installed. Our typeahead is going to make API calls on our behalf, decode the response, and keep track of the state of requests using a special <code class="codehilite"><span class="kt">RemoteData</span></code> data type. Let's go ahead and install our dependencies:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># These should already be installed as part of the project setup</span>
bower i --save purescript-halogen purescript-halogen-select purescript-affjax

<span class="c1"># These are new dependencies</span>
bower i --save purescript-argonaut purescript-remotedata

<span class="c1"># Let&#39;s compile the new dependencies to ensure they&#39;re available to import</span>
yarn build
</pre></div>
</td></tr></table>

<h3 id="integrate-the-component">Integrate the component<a class="headerlink" href="#integrate-the-component" title="Permanent link">&para;</a></h3>
<p>Now let's make sure we have <code>Select</code> ready to go in our component. Import the library:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Select</span> <span class="k">as</span> <span class="n">Select</span>
<span class="kr">import</span> <span class="nn">Select.Setters</span> <span class="k">as</span> <span class="n">Setters</span>
</pre></div>
</td></tr></table>

<p>Next, since <code>Select</code> is going to be a child component, we'll need to update several types and functions. We will:</p>
<ul>
<li>Delete the unnecessary <code class="codehilite"><span class="kt">NoOp</span></code> query and relevant case in <code class="codehilite"><span class="nf">eval</span></code></li>
<li>Add a new query to handle messages emitted by <code>Select</code></li>
<li>Update our <code class="codehilite"><span class="kt">ChildQuery</span></code> type synonym to contain <code>Select</code>'s query type</li>
<li>Update the type signatures for <code class="codehilite"><span class="nf">eval</span></code> and <code class="codehilite"><span class="nf">render</span></code> with the new <code class="codehilite"><span class="kt">ChildQuery</span></code></li>
<li>Add a new case to <code class="codehilite"><span class="nf">eval</span></code> for our new <code class="codehilite"><span class="kt">HandleSelect</span></code> query</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This tutorial doesn't explain things like child queries, slots, inputs, rendering, <code class="codehilite"><span class="kt">Free</span></code>, <code class="codehilite"><span class="nf">eval</span></code> functions, or other crucial Halogen knowledge. If you feel lost, I'd recommend checking out the <a href="https://citizennet.github.io/purescript-halogen-select/tutorials/dropdown">dropdown tutorial</a> before continuing.</p>
</div>
<p>Of course, we won't be prepared to handle messages or use <code>Select</code>'s queries without knowing what they are. Let's start with the query type for the <code>Select</code> component, <code class="codehilite"><span class="kt">QueryF</span></code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">-- | - `o`: The query type of the component that will mount this component in a child slot.</span>
<span class="c1">-- |        This allows you to embed your own queries into the `Select` component.</span>
<span class="c1">-- | - `item`: Your custom item type. It can be a simple type like `String`, or something</span>
<span class="c1">-- |           complex like `CalendarItem StartDate EndDate (Maybe Disabled)`.</span>
<span class="kr">data</span> <span class="kt">QueryF</span> <span class="n">o</span> <span class="n">item</span> <span class="n">a</span>
  <span class="ow">=</span> <span class="kt">Search</span> <span class="kt">String</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">Highlight</span> <span class="kt">Target</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">Select</span> <span class="kt">Int</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">Focus</span> <span class="kt">Boolean</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">Key</span> <span class="kt">KE</span><span class="o">.</span><span class="kt">KeyboardEvent</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">PreventClick</span> <span class="kt">ME</span><span class="o">.</span><span class="kt">MouseEvent</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">SetVisibility</span> <span class="kt">Visibility</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">GetVisibility</span> <span class="p">(</span><span class="kt">Visibility</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span>
  <span class="o">|</span> <span class="kt">ReplaceItems</span> <span class="p">(</span><span class="kt">Array</span> <span class="n">item</span><span class="p">)</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">Raise</span> <span class="p">(</span><span class="n">o</span> <span class="kt">Unit</span><span class="p">)</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">Receive</span> <span class="p">(</span><span class="kt">Input</span> <span class="n">o</span> <span class="n">item</span><span class="p">)</span> <span class="n">a</span>
</pre></div>
</td></tr></table>

<p>Already we're faced with an interesting decision: how should we fill in the type variables that <code>Select</code> expects?</p>
<ul>
<li><code>o</code> represents the type of queries that can be embedded in the component. You should fill this in with your parent component's query type. If you follow Halogen convention and name your type <code class="codehilite"><span class="kt">Query</span></code>, then filling this variable in will produce <code class="codehilite"><span class="kt">Select</span><span class="o">.</span><span class="kt">Query</span> <span class="kt">Query</span> <span class="n">item</span> <span class="n">eff</span></code>. If you take a look at where this variable is used, you'll see it shows up in the <code>Select</code> component's <code class="codehilite"><span class="kt">Raise</span></code> and <code class="codehilite"><span class="kt">Receive</span></code> queries. The <code class="codehilite"><span class="kt">Raise</span></code> query is a wrapper that you can use to embed your query into the render function you provide to the component. The <code class="codehilite"><span class="kt">Receive</span></code> query leverages <code>Select</code>'s <code class="codehilite"><span class="kt">Input</span></code> type, which includes that render function. I'll have a lot more to say about embedding your own query type into <code>Select</code> later on.</li>
</ul>
<p>The second type argument is more interesting. <code>Select</code> allows you to provide any type as your selectable "item". While in this tutorial we're going to stick with strings you could very well make a significantly more information-rich type.</p>
<details class="tip"><summary>Writing useful item types</summary><p>Any time you need to render some items differently than others, or you need different logic for when one item is selected vs. another, you should encode that information in the item type. For example, at CitizenNet, our calendar component has an item type like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">CalendarItem</span> <span class="ow">=</span> <span class="kt">CalendarItem</span> <span class="kt">SelectedStatus</span> <span class="kt">DisabledStatus</span> <span class="kt">Boundary</span> <span class="kt">Range</span> <span class="kt">Date</span>
</pre></div>
</td></tr></table>

<p>These custom types give us everything we need to know to render various dates and handle them when selected. For example, if you want some items to be selectable and others to be disabled, you could create an item type like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Item</span> <span class="ow">=</span> <span class="kt">Selectable</span> <span class="kt">String</span> <span class="o">|</span> <span class="kt">Disabled</span> <span class="kt">String</span>

<span class="nf">renderItem</span> <span class="n">ix</span> <span class="p">(</span><span class="kt">Selectable</span> <span class="n">str</span><span class="p">)</span>
  <span class="ow">=</span> <span class="kt">HH</span><span class="o">.</span><span class="n">li</span> <span class="p">(</span> <span class="kt">Setters</span><span class="o">.</span><span class="n">setItemProps</span> <span class="n">ix</span> <span class="p">[</span> <span class="p">]</span> <span class="p">)</span> <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">str</span> <span class="p">]</span>
<span class="nf">renderItem</span> <span class="kr">_</span> <span class="p">(</span><span class="kt">Disabled</span> <span class="n">str</span><span class="p">)</span>
  <span class="ow">=</span> <span class="kt">HH</span><span class="o">.</span><span class="n">li_</span>  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">str</span> <span class="p">]</span>
</pre></div>
</td></tr></table>

</details>
<p>With all this information in mind, let's go ahead and make those changes:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Query</span> <span class="n">a</span>
  <span class="ow">=</span> <span class="kt">HandleSelect</span> <span class="p">(</span><span class="kt">Select</span><span class="o">.</span><span class="kt">Message</span> <span class="kt">Query</span> <span class="kt">String</span><span class="p">)</span> <span class="n">a</span>

<span class="kr">type</span> <span class="kt">ChildSlot</span> <span class="ow">=</span> <span class="kt">Unit</span>
<span class="kr">type</span> <span class="kt">ChildQuery</span> <span class="ow">=</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Query</span> <span class="kt">Query</span> <span class="kt">String</span>

<span class="nf">component</span> <span class="ow">=</span>
  <span class="o">...</span>
  <span class="n">render</span> <span class="ow">::</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentHTML</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="n">m</span>
  <span class="n">render</span> <span class="n">st</span> <span class="ow">=</span> <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span> <span class="kt">[]</span>

  <span class="n">eval</span> <span class="ow">::</span> <span class="kt">Query</span> <span class="o">~&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentDSL</span> <span class="kt">State</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="kt">Message</span> <span class="n">m</span>
  <span class="n">eval</span> <span class="ow">=</span> <span class="kr">case</span> <span class="kr">_</span> <span class="kr">of</span>
    <span class="c1">-- We&#39;ll just stub this out for the time being.</span>
    <span class="kt">HandleSelect</span> <span class="n">message</span> <span class="n">next</span> <span class="ow">-&gt;</span> <span class="n">pure</span> <span class="n">next</span>
</pre></div>
</td></tr></table>

<p>Next, we'll actually mount the <code>Select</code> component. We have everything except for the component's <code class="codehilite"><span class="kt">Input</span></code> type so far, so we'll fill that in and leave the input as a type hole.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Halogen.HTML.Events</span> <span class="k">as</span> <span class="n">HE</span>

<span class="nf">render</span> <span class="ow">::</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentHTML</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="n">m</span>
<span class="nf">render</span> <span class="n">st</span> <span class="ow">=</span>
    <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">slot</span> <span class="n">unit</span> <span class="kt">Select</span><span class="o">.</span><span class="n">component</span> <span class="o">?</span><span class="n">input</span> <span class="p">(</span><span class="kt">HE</span><span class="o">.</span><span class="n">input</span> <span class="kt">HandleSelect</span><span class="p">)</span> <span class="p">]</span>
</pre></div>
</td></tr></table>

<p>With that out of the way, we can turn to the component's input type. Here's what we're required to fill in, as per the <a href="https://pursuit.purescript.org/packages/purescript-halogen-select/3.0.0/docs/Select#t:Input"><code>Select</code> module documentation</a>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">-- | Text-driven inputs will operate like a normal search-driven selection component.</span>
<span class="c1">-- | Toggle-driven inputs will capture key streams and debounce in reverse (only notify</span>
<span class="c1">-- | about searches when time has expired).</span>
<span class="kr">data</span> <span class="kt">InputType</span>
  <span class="ow">=</span> <span class="kt">TextInput</span>
  <span class="o">|</span> <span class="kt">Toggle</span>

<span class="c1">-- | The component&#39;s input type, which includes the component&#39;s render function. This</span>
<span class="c1">-- | render function can also be used to share data with the parent component, as every</span>
<span class="c1">-- | time the parent re-renders, the render function will refresh in `Select`.</span>
<span class="kr">type</span> <span class="kt">Input</span> <span class="n">o</span> <span class="n">item</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="n">inputType</span>     <span class="ow">::</span> <span class="kt">InputType</span>
  <span class="p">,</span> <span class="n">items</span>         <span class="ow">::</span> <span class="kt">Array</span> <span class="n">item</span>
  <span class="p">,</span> <span class="n">initialSearch</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">String</span>
  <span class="p">,</span> <span class="n">debounceTime</span>  <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Milliseconds</span>
  <span class="p">,</span> <span class="n">render</span>        <span class="ow">::</span> <span class="kt">State</span> <span class="n">item</span> <span class="ow">-&gt;</span> <span class="kt">ComponentHTML</span> <span class="n">o</span> <span class="n">item</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Let's look at these one-by-one:</p>
<ol>
<li>We're using an input field in the DOM, so we'll use the <code class="codehilite"><span class="kt">TextInput</span></code> type to drive the component.</li>
<li>We don't have any items yet (they'll be fetched via the Star Wars API), so we'll provide an empty array.</li>
<li>We don't want there to be an initial search; we'll wait for the user to type something. However, if at any point we want to fill in text in the input field (for example, set the text to the full selection when the user selects something), we can use this field to accomplish that.</li>
<li>We're making API calls every time the user performs a search, so we'll set a reasonable debounce time of a few hundred milliseconds.</li>
<li>Ah, the big issue: we need to write a render function and pass it in to the component. We don't have one yet, so we'll stub this out with a simple empty <code class="codehilite"><span class="nf">div</span></code>.</li>
</ol>
<p>Let's write that input record now:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Data.Time.Duration</span> <span class="p">(</span><span class="kt">Milliseconds</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>

<span class="nf">render</span> <span class="ow">::</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentHTML</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="n">m</span>
<span class="nf">render</span> <span class="n">st</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">slot</span> <span class="n">unit</span> <span class="kt">Select</span><span class="o">.</span><span class="n">component</span> <span class="n">selectInput</span> <span class="p">(</span><span class="kt">HE</span><span class="o">.</span><span class="n">input</span> <span class="kt">HandleSelect</span><span class="p">)</span> <span class="p">]</span>

<span class="nf">selectInput</span> <span class="ow">::</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Input</span> <span class="kt">Query</span> <span class="kt">String</span>
<span class="nf">selectInput</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="n">inputType</span><span class="kt">:</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">TextInput</span>
  <span class="p">,</span> <span class="n">items</span><span class="kt">:</span> <span class="kt">[]</span>
  <span class="p">,</span> <span class="n">initialSearch</span><span class="kt">:</span> <span class="kt">Nothing</span>
  <span class="p">,</span> <span class="n">debounceTime</span><span class="kt">:</span> <span class="kt">Just</span> <span class="o">$</span> <span class="kt">Milliseconds</span> <span class="mf">250.0</span>
  <span class="p">,</span> <span class="n">render</span><span class="kt">:</span> <span class="nf">\</span><span class="kr">_</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span> <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;Not implemented&quot;</span> <span class="p">]</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>All right! We've fully integrated the <code>Select</code> component. It's a little tedious to integrate the component the first time you do it, but it soon becomes second nature. At this point, we're ready to start writing our typeahead.</p>
<div class="admonition danger">
<p>Now would be a good time to verify that this component is rendering properly. Compile the project and point your browser to <code>dist/index.html</code>. You should see text rendering from within <code>Select</code>.</p>
</div>
<h2 id="a-minimal-typeahead">A minimal typeahead<a class="headerlink" href="#a-minimal-typeahead" title="Permanent link">&para;</a></h2>
<p>Let's take a step back now that we have <code>Select</code> integrated. We are building a typeahead that will fetch some data asynchronously when the user makes a search. It needs to maintain a list of items that can be selected, and a list of items that have already been selected. The user should only be able to select any item once, so these two lists should have no shared items. We'd like the typeahead to handle all the data fetching and selections behind the scenes, and only notify the parent component when the selections have been updated.</p>
<p>With this information in mind, we can step through the key data types in our Halogen component and ensure they accurately capture the features we want.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the dropdown tutorial, we started by writing a render function and only later worried about state, queries, messages, and so on. However, I usually like to work in the other direction. We already know the behaviors and data we need to manage, and we don't need to render anything to implement them, though we'll certainly use our rendered component for testing.</p>
<p>Instead, we'll work through the major data types in our component and only once those are completed will we write some minimal rendering code. It might feel a little strange to spend so much time on data without once touching the HTML, but by the time we reach our rendering function it will naturally extend from the data.</p>
</div>
<h3 id="state">State<a class="headerlink" href="#state" title="Permanent link">&para;</a></h3>
<p>From our requirements, we know we'll need some information:</p>
<ul>
<li>A list of items that can be selected by the user</li>
<li>A list of items that have already been selected, and which can be removed</li>
<li>The user's last search, so we can use it to fetch new data from the Star Wars API</li>
</ul>
<p>It'll also be nice to have some extra information purely for rendering purposes, like:</p>
<ul>
<li>An indicator as to whether the menu should be displayed or not</li>
<li>An indicator as to which item the user has focused, so we can highlight it</li>
</ul>
<p>We have access to two distinct <code class="codehilite"><span class="kt">State</span></code> types when we use <code>Select</code>: the parent component state, which we own, and the <code>Select</code> component's state, which we can read and write. There's no point in duplicating information between the two if we can help it. But we have access to even more information: messages output by the component. Sometimes we can simply rely on the contents of these messages to take action without ever storing the result in state.</p>
<p>Let's take a quick look at what <code>Select</code> provides (take a look at the <a href="https://pursuit.purescript.org/packages/purescript-halogen-select/1.0.0/docs/Select#t:State">module documentation</a> for more details):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">type</span> <span class="kt">State</span> <span class="n">item</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="n">inputType</span>        <span class="ow">::</span> <span class="kt">InputType</span>
  <span class="p">,</span> <span class="n">search</span>           <span class="ow">::</span> <span class="kt">String</span>
  <span class="p">,</span> <span class="n">debounceTime</span>     <span class="ow">::</span> <span class="kt">Milliseconds</span>
  <span class="p">,</span> <span class="n">debouncer</span>        <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Debouncer</span>
  <span class="p">,</span> <span class="n">inputElement</span>     <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">HTMLElement</span>
  <span class="p">,</span> <span class="n">items</span>            <span class="ow">::</span> <span class="kt">Array</span> <span class="n">item</span>
  <span class="p">,</span> <span class="n">visibility</span>       <span class="ow">::</span> <span class="kt">Visibility</span>
  <span class="p">,</span> <span class="n">highlightedIndex</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Int</span>
  <span class="p">,</span> <span class="n">lastIndex</span>        <span class="ow">::</span> <span class="kt">Int</span>
  <span class="p">}</span>

<span class="kr">data</span> <span class="kt">Message</span> <span class="n">o</span> <span class="n">item</span>
  <span class="ow">=</span> <span class="kt">Searched</span> <span class="kt">String</span>
  <span class="o">|</span> <span class="kt">Selected</span> <span class="n">item</span>
  <span class="o">|</span> <span class="kt">VisibilityChanged</span> <span class="kt">Visibility</span>
  <span class="o">|</span> <span class="kt">Emit</span> <span class="p">(</span><span class="n">o</span> <span class="kt">Unit</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>It looks like we already have the list of selectable items stored in <code>Select</code>, so we don't need that in our component state. We're fetching new items via an external API, so after each new search we can simply pass the new items straight down.</p>
<p>We also have the user's search stored in <code>State</code> and also raised as a message every time the debouncer runs out. We don't really care about every keystroke the user types, so we'll rely on the <code class="codehilite"><span class="kt">Searched</span></code> message for this information.</p>
<p>We have our two pieces of rendering information, too, with the <code class="codehilite"><span class="nf">visibility</span></code> and <code class="codehilite"><span class="nf">highlightedIndex</span></code> fields.</p>
<p>In fact, it looks like the only thing we have to store in our <code class="codehilite"><span class="kt">State</span></code> is the list of selecetions! That keeps things simple.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">type</span> <span class="kt">State</span> <span class="ow">=</span> <span class="p">{</span> <span class="n">selections</span> <span class="ow">::</span> <span class="kt">Array</span> <span class="kt">String</span> <span class="p">}</span>
</pre></div>
</td></tr></table>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code>Select</code> doesn't manage any selections on your behalf. What should happen when an item gets selected, after all? In some cases, you might want to stick it into a "selected" list and remove it from the list of available options. In others, you might want it to be selectable multiple times. Or you might want to just apply a highlight, like in a calendar picker. Rather than force you to fill out a configuration record, <code>Select</code> defers the decision to you.</p>
</div>
<p>This is OK, but I'd like some more information. We're fetching data asynchronously, right? That means that requests could possibly fail, or they might be in progress for a long time, or perhaps they might never get triggered in the first place. Ideally our typeahead could render differently depending on these states. If we don't keep track of our requests in <code class="codehilite"><span class="kt">State</span></code>, we won't have any of this information available for rendering.</p>
<p>It's the same idea as using an information-rich custom <code>item</code> type to add nuance to your rendering code. Luckily, there already exists a lovely package named <code>purescript-remotedata</code> that supplies us with a data type we can use to model each of these states:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">RemoteData</span> <span class="n">e</span> <span class="n">a</span>
  <span class="ow">=</span> <span class="kt">NotAsked</span>
  <span class="o">|</span> <span class="kt">Loading</span>
  <span class="o">|</span> <span class="kt">Failure</span> <span class="n">e</span>
  <span class="o">|</span> <span class="kt">Success</span> <span class="n">a</span>
</pre></div>
</td></tr></table>

<p>So while it's not strictly necessary to maintain a list of items in our state, we'll leverage <code class="codehilite"><span class="kt">RemoteData</span></code> to have a more useful state type.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">type</span> <span class="kt">State</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="n">items</span> <span class="ow">::</span> <span class="kt">RemoteData</span> <span class="kt">String</span> <span class="p">(</span><span class="kt">Array</span> <span class="kt">String</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">selections</span> <span class="ow">::</span> <span class="kt">Array</span> <span class="kt">String</span>
  <span class="p">}</span>

<span class="nf">initialState</span> <span class="ow">::</span> <span class="kt">Input</span> <span class="ow">-&gt;</span> <span class="kt">State</span>
<span class="nf">initialState</span> <span class="ow">=</span> <span class="n">const</span>
  <span class="p">{</span> <span class="n">items</span><span class="kt">:</span> <span class="kt">NotAsked</span>
  <span class="p">,</span> <span class="n">selections</span><span class="kt">:</span> <span class="kt">[]</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="query">Query<a class="headerlink" href="#query" title="Permanent link">&para;</a></h3>
<p>Now that we've got a usable <code class="codehilite"><span class="kt">State</span></code> type, let's turn to our queries. Queries are the computations available to the component, so they're the place where we ought to think about what the typeahead should <em>do</em>, rather than just how it should render.</p>
<p>Just like <code class="codehilite"><span class="kt">State</span></code>, when we write our own <code class="codehilite"><span class="kt">Query</span></code> type on top of <code>Select</code>, we should consider what is already available in the component. As usual, we'll turn to the <a href="https://pursuit.purescript.org/packages/purescript-halogen-select/3.0.0/docs/Select#t:QueryF">module documentation</a> to look at our available queries. I'd recommend scrolling through the available functions to get a glimpse of what <code>Select</code> offers, but we'll skip to the main points here.</p>
<p><code>Select</code> is going to manage all the keyboard events, text input, debouncing, moving the highlighted index, and so on. On top of that, we'll need to add some extra functionality: the ability to remove items that have already been selected, and the ability to fetch new items when the user performs a search. We'll at least need two queries to handle these two features.</p>
<p>Luckily, though, we already <em>have</em> a query available for when a new search has been performed: our <code class="codehilite"><span class="kt">HandleSelect</span></code> query tied to the <code class="codehilite"><span class="kt">Select</span><span class="o">.</span><span class="kt">Searched</span></code> message! That means we really only need one new query:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Query</span> <span class="n">a</span>
  <span class="ow">=</span> <span class="kt">HandleSelect</span> <span class="p">(</span><span class="kt">Select</span><span class="o">.</span><span class="kt">Message</span> <span class="kt">Query</span> <span class="kt">String</span><span class="p">)</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">Remove</span> <span class="kt">String</span> <span class="n">a</span>

<span class="nf">eval</span> <span class="ow">::</span> <span class="kt">Query</span> <span class="o">~&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentDSL</span> <span class="kt">State</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="kt">Message</span> <span class="n">m</span>
<span class="nf">eval</span> <span class="ow">=</span> <span class="kr">case</span> <span class="kr">_</span> <span class="kr">of</span>
  <span class="kt">HandleSelect</span> <span class="n">message</span> <span class="n">next</span> <span class="ow">-&gt;</span> <span class="kr">case</span> <span class="n">message</span> <span class="kr">of</span>
    <span class="kt">Select</span><span class="o">.</span><span class="kt">Searched</span> <span class="n">str</span> <span class="ow">-&gt;</span>
      <span class="n">pure</span> <span class="n">next</span>
    <span class="kt">Select</span><span class="o">.</span><span class="kt">Selected</span> <span class="n">item</span> <span class="ow">-&gt;</span>
      <span class="n">pure</span> <span class="n">next</span>
    <span class="kt">Select</span><span class="o">.</span><span class="kt">VisibilityChanged</span> <span class="n">vis</span> <span class="ow">-&gt;</span>
      <span class="n">pure</span> <span class="n">next</span>
    <span class="kt">Select</span><span class="o">.</span><span class="kt">Emit</span> <span class="n">query</span> <span class="ow">-&gt;</span>
      <span class="n">pure</span> <span class="n">next</span>

  <span class="kt">Remove</span> <span class="n">item</span> <span class="n">next</span> <span class="ow">-&gt;</span>
    <span class="n">pure</span> <span class="n">next</span>
</pre></div>
</td></tr></table>

<p>What do we want to happen in each of these queries? Let's work from the bottom to the top.</p>
<h4 id="remove">Remove<a class="headerlink" href="#remove" title="Permanent link">&para;</a></h4>
<p>When the user clicks on an item that is already selected, we want to remove it from the selected list. We also want to re-insert it into the available items in <code>Select</code>. It's easy enough to accomplish this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">Remove</span> <span class="n">item</span> <span class="n">next</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
  <span class="kt">H</span><span class="o">.</span><span class="n">modify</span> <span class="nf">\</span><span class="n">st</span> <span class="ow">-&gt;</span> <span class="n">st</span> <span class="p">{</span> <span class="n">selections</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="kr">_</span> <span class="o">/=</span> <span class="n">item</span><span class="p">)</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span> <span class="p">}</span>
  <span class="n">st</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">get</span>
  <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">query</span> <span class="n">unit</span>
    <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">replaceItems</span>
    <span class="o">$</span> <span class="n">difference</span> <span class="p">(</span><span class="n">withDefault</span> <span class="kt">[]</span> <span class="n">st</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span>
  <span class="n">pure</span> <span class="n">next</span>
</pre></div>
</td></tr></table>

<h4 id="emit">Emit<a class="headerlink" href="#emit" title="Permanent link">&para;</a></h4>
<p>What should we do when we get the <code class="codehilite"><span class="kt">Emit</span></code> message? This is returning our own query to us so we can run it, so we can recursively call <code class="codehilite"><span class="nf">eval</span></code> with the query. You'll use this pattern every time you implement a new component with <code>Select</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">Select</span><span class="o">.</span><span class="kt">Emit</span> <span class="n">query</span> <span class="ow">-&gt;</span> <span class="n">eval</span> <span class="n">query</span> <span class="o">*&gt;</span> <span class="n">pure</span> <span class="n">next</span>
</pre></div>
</td></tr></table>

<h4 id="visibilitychange">VisibilityChange<a class="headerlink" href="#visibilitychange" title="Permanent link">&para;</a></h4>
<p>What about when the visibility changes? We don't actually care about this one, so we'll ignore it. It's useful for validation, if we were to implement that.</p>
<h4 id="selected">Selected<a class="headerlink" href="#selected" title="Permanent link">&para;</a></h4>
<p>What about when an item is selected? This one is like the inverse of our <code class="codehilite"><span class="kt">Remove</span></code> query. We want to remove the item from the available items and add it to the list of selections.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">Select</span><span class="o">.</span><span class="kt">Selected</span> <span class="n">item</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
  <span class="kt">H</span><span class="o">.</span><span class="n">modify</span> <span class="nf">\</span><span class="n">st</span> <span class="ow">-&gt;</span> <span class="n">st</span> <span class="p">{</span> <span class="n">selections</span> <span class="ow">=</span> <span class="n">item</span> <span class="kt">:</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span> <span class="p">}</span>
  <span class="n">st</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">get</span>
  <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">query</span> <span class="n">unit</span>
    <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">replaceItems</span>
    <span class="o">$</span> <span class="n">difference</span> <span class="p">(</span><span class="n">withDefault</span> <span class="kt">[]</span> <span class="n">st</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span>
  <span class="n">pure</span> <span class="n">next</span>
</pre></div>
</td></tr></table>

<h4 id="searched">Searched<a class="headerlink" href="#searched" title="Permanent link">&para;</a></h4>
<p>We can finally consider what to do when the user performs a search. We won't do any fancy filtering on our own; we're going to punt that responsibility to an external API. Still, now we have to write the code to fetch that data.</p>
<p>Our function will hit the Star Wars API, decode the result into an array of strings, and then return them. In the case of failure, we'll return an error message.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Data.Argonaut</span> <span class="p">(</span><span class="kt">Json</span><span class="p">,</span> <span class="nf">decodeJson</span><span class="p">,</span> <span class="p">(</span><span class="o">.?</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">Network.HTTP.Affjax</span> <span class="k">as</span> <span class="n">AX</span>
<span class="kr">import</span> <span class="nn">Network.HTTP.Affjax.Response</span> <span class="k">as</span> <span class="n">Response</span>

<span class="nf">fetchItems</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Aff</span> <span class="p">(</span><span class="kt">Either</span> <span class="kt">String</span> <span class="p">(</span><span class="kt">Array</span> <span class="kt">String</span><span class="p">))</span>
<span class="nf">fetchItems</span> <span class="n">str</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">res</span> <span class="ow">&lt;-</span> <span class="kr">_</span><span class="o">.</span><span class="n">response</span> <span class="o">&lt;$&gt;</span>
    <span class="p">(</span> <span class="kt">AX</span><span class="o">.</span><span class="n">get</span>
    <span class="o">$</span> <span class="kt">Response</span><span class="o">.</span><span class="n">json</span>
    <span class="o">$</span> <span class="s">&quot;https://swapi.co/api/people/?search=&quot;</span> <span class="o">&lt;&gt;</span> <span class="n">str</span>
    <span class="p">)</span>

  <span class="n">pure</span> <span class="o">$</span> <span class="kr">do</span>
    <span class="n">obj</span> <span class="ow">&lt;-</span> <span class="n">decodeJson</span> <span class="n">res</span>
    <span class="n">arr</span> <span class="ow">&lt;-</span> <span class="n">obj</span> <span class="o">.?</span> <span class="s">&quot;results&quot;</span>
    <span class="n">traverse</span> <span class="p">(</span><span class="n">decodeJson</span> <span class="o">&lt;=&lt;</span> <span class="n">flip</span> <span class="p">(</span><span class="o">.?</span><span class="p">)</span> <span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="n">arr</span>
</pre></div>
</td></tr></table>

<p>Now that we have this helper function, we can handle new searches that users perform. First, we'll put our typeahead into the <code class="codehilite"><span class="kt">Loading</span></code> state to represent an ongoing request. Then, we'll empty out the old items in <code>Select</code> to avoid out-of-sync data. Then, we'll fetch and decode our items, convert the result from <code class="codehilite"><span class="kt">Either</span></code> to <code class="codehilite"><span class="kt">RemoteData</span></code>, and finally set it on <code class="codehilite"><span class="kt">State</span></code>.</p>
<p>Once our new items have been set, we can use the result to update <code>Select</code> just like we did when we handled new selections or removals.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">Select</span><span class="o">.</span><span class="kt">Searched</span> <span class="n">string</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
  <span class="kt">H</span><span class="o">.</span><span class="n">modify</span> <span class="kr">_</span> <span class="p">{</span> <span class="n">items</span> <span class="ow">=</span> <span class="kt">Loading</span> <span class="p">}</span>
  <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">query</span> <span class="n">unit</span> <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">replaceItems</span> <span class="kt">[]</span>
  <span class="n">newItems</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">liftAff</span> <span class="p">(</span><span class="n">fetchItems</span> <span class="n">string</span><span class="p">)</span>
  <span class="kt">H</span><span class="o">.</span><span class="n">modify</span> <span class="kr">_</span> <span class="p">{</span> <span class="n">items</span> <span class="ow">=</span> <span class="n">fromEither</span> <span class="n">newItems</span> <span class="p">}</span>

  <span class="n">st</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">get</span>
  <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">query</span> <span class="n">unit</span>
    <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">replaceItems</span>
    <span class="o">$</span> <span class="n">difference</span> <span class="p">(</span><span class="n">withDefault</span> <span class="kt">[]</span> <span class="n">st</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span>
</pre></div>
</td></tr></table>

<p>That's it! Our typeahead has all the logic necessary to function as required. All that's left to do is actually write the render function.</p>
<h2 id="rendering">Rendering<a class="headerlink" href="#rendering" title="Permanent link">&para;</a></h2>
<p>We have all the state and behavior necessary to run a working typeahead. Now, let's write the render function.</p>
<p>When you write a render function for a <code>Select</code> component, keep in mind that the function is going to be run <em>by</em> the child component. You can see this right away from the type signature of the render function that <code>Select</code> expects:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">myRenderFunction</span> <span class="ow">::</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">State</span> <span class="n">item</span> <span class="ow">-&gt;</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">ComponentHTML</span> <span class="n">o</span> <span class="n">item</span>
</pre></div>
</td></tr></table>

<p>In our case, we've already specialized our parent query, item, and effects, so the type signature is actually this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">myRenderFunction</span>
  <span class="ow">::</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">State</span> <span class="kt">String</span>
  <span class="ow">-&gt;</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">ComponentHTML</span> <span class="kt">Query</span> <span class="kt">String</span>
</pre></div>
</td></tr></table>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When you write a component with <code>Select</code>, you'll usually want access to the parent component's state and query algebra. This is what makes the pattern powerful: you can use any values from your state in the render function you provide to <code>Select</code>, and you can embed any queries from your query algebra, too. Most of the time developers will stay in scope with the parent component by writing the <code>Select</code> render function within a <code class="codehilite"><span class="kr">where</span></code> clause. However, you could also write a render function outside the parent component so long as it takes the parent state as an argument, like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">selectRenderFunction</span>
  <span class="ow">::</span> <span class="kt">Parent</span><span class="o">.</span><span class="kt">State</span>
  <span class="ow">-&gt;</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">State</span> <span class="kt">String</span>
  <span class="ow">-&gt;</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">ComponentHTML</span> <span class="kt">Parent</span><span class="o">.</span><span class="kt">Query</span> <span class="kt">String</span>
</pre></div>
</td></tr></table>

<p>Then you can write this render function anywhere you'd like while retaining access to the parent's state and query algebra. <code>Select</code> will not accept this function as-is, however; you'll need to apply it to the parent state before sending the function in as input:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">selectInput</span> <span class="ow">=</span> <span class="p">{</span> <span class="o">...</span><span class="p">,</span> <span class="n">render</span><span class="kt">:</span> <span class="n">selectRenderFunction</span> <span class="n">parentState</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</td></tr></table>

</div>
<p>Since you write the render function to pass to Select, you retain full control of the design and most of the structure of your HTML. All that <code>Select</code> expects from you is that you apply the three helper functions from <code class="codehilite"><span class="kt">Setters</span></code>:</p>
<ul>
<li><code class="codehilite"><span class="nf">setItemProps</span></code> on each item that can be selected</li>
<li><code class="codehilite"><span class="nf">setContainerProps</span></code> on the parent HTML element of all the items</li>
<li><code class="codehilite"><span class="nf">setInputProps</span></code> on the text input</li>
</ul>
<p>For this reason, I usually break my component's render function into three helpers. Let's go ahead and write our render function for the typeahead.</p>
<p>Our overall function is going to take the parent state, the <code>Select</code> state, and output the <code>Select</code> component HTML type:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">typeahead</span>
  <span class="ow">::</span> <span class="kt">State</span>
  <span class="ow">-&gt;</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">State</span> <span class="kt">String</span>
  <span class="ow">-&gt;</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">ComponentHTML</span> <span class="kt">Query</span> <span class="kt">String</span>
<span class="nf">typeahead</span> <span class="n">parentState</span> <span class="n">childState</span> <span class="ow">=</span> <span class="o">...</span>
</pre></div>
</td></tr></table>

<p>Let's write this function from top to bottom. We want our typeahead to have the list of selected items above the input field, then the input field, then the list of available items (if there are any). Ultimately, with helper functions, we'd like to write this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">typeahead</span> <span class="n">parentState</span> <span class="n">childState</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="n">renderSelections</span><span class="p">,</span> <span class="n">renderInput</span><span class="p">,</span> <span class="n">renderContainer</span> <span class="p">]</span>
  <span class="kr">where</span>
    <span class="o">...</span>
</pre></div>
</td></tr></table>

<p>Let's start with the first one: <code class="codehilite"><span class="nf">renderSelections</span></code>. This function will leverage only the parent state, which contains the selections, and won't use anything from <code>Select</code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In fact you don't need to render the selections inside <code>Select</code> at all -- you could render the selections first, and then mount the <code>Select</code> component below. We use this approach for our own typeaheads at CitizenNet. However, embedding the selections into the <code>Select</code> component allows me to show off how embedding parent queries works and it's an equally viable design, so that's the approach taken here.</p>
</div>
<p>We're just going to render an unordered list of items that have been selected. If the user clicks on one of them, then we'll remove the selection. We can remove items with the <code class="codehilite"><span class="kt">Remove</span></code> query that we wrote a little earlier.</p>
<p>But wait! Since this is rendering inside of <code>Select</code>, it needs to have the <code>Select</code> type signature. If we try to write this function it will fail:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">-- The items that have already been selected and can be removed</span>
<span class="nf">renderSelections</span> <span class="ow">::</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">ComponentHTML</span> <span class="kt">Query</span> <span class="kt">String</span>
<span class="nf">renderSelections</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">ul_</span>
  <span class="p">(</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span> <span class="o">&lt;#&gt;</span>
      <span class="p">(</span><span class="nf">\</span><span class="n">item</span> <span class="ow">-&gt;</span>
        <span class="kt">HH</span><span class="o">.</span><span class="n">li</span>
        <span class="p">[</span> <span class="kt">HE</span><span class="o">.</span><span class="n">onClick</span> <span class="o">$</span> <span class="kt">HE</span><span class="o">.</span><span class="n">input_</span> <span class="o">$</span> <span class="kt">Remove</span> <span class="n">item</span> <span class="p">]</span>
        <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">]</span>
      <span class="p">)</span>
  <span class="p">)</span>
</pre></div>
</td></tr></table>

<p>The compiler gives us this error:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">Error</span> <span class="n">found</span> <span class="kr">in</span> <span class="kr">module</span> <span class="nn">Component</span>

  <span class="kt">Could</span> <span class="n">not</span> <span class="n">match</span> <span class="kr">type</span>

    <span class="kt">Free</span> <span class="p">(</span><span class="kt">QueryF</span> <span class="n">t2</span> <span class="n">t3</span> <span class="n">t4</span><span class="p">)</span>

  <span class="n">with</span> <span class="kr">type</span>

    <span class="kt">Query</span>

<span class="nf">while</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">match</span> <span class="kr">type</span> <span class="kt">Free</span> <span class="p">(</span><span class="kt">QueryF</span> <span class="n">t2</span> <span class="n">t3</span> <span class="n">t4</span><span class="p">)</span> <span class="kt">Unit</span>
  <span class="n">with</span> <span class="kr">type</span> <span class="kt">Query</span> <span class="kt">Unit</span>
</pre></div>
</td></tr></table>

<p>The problem is that we're using a parent query in the body of a render function for a component with an entirely different query algebra. If we tried to run this in <code>Select</code> it would have no idea what to do with the <code>!#hs Remove</code> query! Instead, we need to <strong>embed</strong> this query.</p>
<p>To embed a parent query into <code>Select</code>, we'll use a query from <code>Select</code> called <code class="codehilite"><span class="kt">Raise</span></code> and a message called <code class="codehilite"><span class="kt">Emit</span></code>.</p>
<p>We've already seen <code class="codehilite"><span class="kt">Emit</span></code> before -- when we receive this message, we simply evaluate the query within it. That's how we can evaluate queries like <code class="codehilite"><span class="kt">Remove</span></code> in the parent component even though the event actually happened inside its child, the <code>Select</code> component.</p>
<p><code class="codehilite"><span class="kt">Raise</span></code> is a new one: this query exists to wrap parent queries so they can be embedded. That's why <code>Select</code> carries around your parent query in its type signature everywhere!</p>
<p>As a rule of thumb, any time you need to extend functionality in <code>Select</code>, you will:</p>
<ol>
<li>Write the new functionality as a query in your parent component and accompanying <code class="codehilite"><span class="nf">eval</span></code> handler. This handler can freely trigger queries and updates in <code>Select</code>, or modify parent state that is then used in the <code>Select</code> render function. This is quite powerful!</li>
<li>Ensure that you are handling output messages from <code>Select</code>, and specifically that when you receive the <code class="codehilite"><span class="kt">Emit</span></code> message that you recursively evaluate it as was demonstrated earlier in the tutorial.</li>
<li>Place the query in <code>Select</code>'s render function wrapped in <code class="codehilite"><span class="kt">Select</span><span class="o">.</span><span class="n">raise</span></code>, triggered by whatever event you would like.</li>
</ol>
<p>Let's see all of this in action:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">renderSelections</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">ul_</span>
  <span class="p">(</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span> <span class="o">&lt;#&gt;</span>
      <span class="p">(</span><span class="nf">\</span><span class="n">item</span> <span class="ow">-&gt;</span>
        <span class="kt">HH</span><span class="o">.</span><span class="n">li</span>
        <span class="p">[</span> <span class="kt">HE</span><span class="o">.</span><span class="n">onClick</span> <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">always</span> <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">raise</span> <span class="o">$</span> <span class="kt">Remove</span> <span class="n">item</span> <span class="n">unit</span> <span class="p">]</span>
        <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">]</span>
      <span class="p">)</span>
  <span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Now we can use this inside <code>Select</code> and it will behave just as if it had been written in the parent all along!</p>
<p>Let's move on to the input field. This field needs to be controlled by <code>Select</code> and must have the <code class="codehilite"><span class="nf">setInputProps</span></code> helper used on its array of properties:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">-- The text input field that will capture key events</span>
<span class="nf">renderInput</span> <span class="ow">=</span> <span class="kt">HH</span><span class="o">.</span><span class="n">input</span> <span class="p">(</span> <span class="kt">Setters</span><span class="o">.</span><span class="n">setInputProps</span> <span class="kt">[]</span> <span class="p">)</span>
</pre></div>
</td></tr></table>

<p>That's it! Now we have all the key events wired up for you. You could embed your own queries here, or add CSS, or whatever you want and the behavior will still work just fine.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code>Select</code> will append the properties it needs to the input field, including <code class="codehilite"><span class="nf">onMouseDown</span></code>, <code>onValueInput</code>, and so on. Unfortunately there can only be one of these handlers in the list of properties, so if you already placed an <code class="codehilite"><span class="nf">onValueInput</span></code> handler it will be overwritten by <code>Select</code>. If you need to trigger some new functionality from the same handler that <code>Select</code> is using, then you can always write a custom <code class="codehilite"><span class="nf">setInputProps</span></code> function for yourself that routes the event to your own query <em>and</em> the relevant <code>Select</code> query. Take a look at the module documentation for <code>Select.Setters</code> to see how.</p>
</div>
<p>Next, let's render the actual items. Remember that we need to use <code class="codehilite"><span class="nf">setContainerProps</span></code> on the containing element (in this case <code class="codehilite"><span class="kt">HH</span><span class="o">.</span><span class="n">ul</span></code>) and <code class="codehilite"><span class="nf">setItemProps</span></code> on each item.</p>
<p>This code is a little trickier. We only want to show the items when the user has focused the typeahead and hide them otherwise. If there are no items, then we want to embed a "Refresh Data" button with some custom functionality. And we want to use <code>Select</code>'s information about which item is highlighted to apply a little CSS.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">-- The parent element holding the items</span>
<span class="nf">renderContainer</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">childState</span><span class="o">.</span><span class="n">visibility</span> <span class="kr">of</span>
  <span class="kt">Select</span><span class="o">.</span><span class="kt">Off</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;&quot;</span>
  <span class="kt">Select</span><span class="o">.</span><span class="kt">On</span> <span class="ow">-&gt;</span>
    <span class="kt">HH</span><span class="o">.</span><span class="n">ul</span>
    <span class="p">(</span> <span class="kt">Setters</span><span class="o">.</span><span class="n">setContainerProps</span> <span class="kt">[]</span> <span class="p">)</span>
    <span class="p">(</span> <span class="kr">case</span> <span class="n">null</span> <span class="n">childState</span><span class="o">.</span><span class="n">items</span> <span class="kr">of</span>
        <span class="n">false</span> <span class="ow">-&gt;</span>
          <span class="n">mapWithIndex</span> <span class="n">renderItem</span> <span class="n">childState</span><span class="o">.</span><span class="n">items</span>
        <span class="kr">_</span> <span class="ow">-&gt;</span>
          <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">li</span>
            <span class="p">[</span> <span class="kt">HE</span><span class="o">.</span><span class="n">onClick</span>
              <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">always</span>
              <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">raise</span>
              <span class="o">$</span> <span class="kt">H</span><span class="o">.</span><span class="n">action</span>
              <span class="o">$</span> <span class="kt">HandleSelect</span> <span class="p">(</span><span class="kt">Select</span><span class="o">.</span><span class="kt">Searched</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;Fetch data again.&quot;</span> <span class="p">]</span>
          <span class="p">]</span>
    <span class="p">)</span>

<span class="c1">-- Each individual item, which will receive an index and the item</span>
<span class="nf">renderItem</span> <span class="n">ix</span> <span class="n">item</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">li</span>
  <span class="p">(</span> <span class="kt">Setters</span><span class="o">.</span><span class="n">setItemProps</span> <span class="n">ix</span>
      <span class="c1">-- If this is the highlighted item, then apply CSS</span>
    <span class="o">$</span> <span class="kr">case</span> <span class="kt">Just</span> <span class="n">ix</span> <span class="o">==</span> <span class="n">childState</span><span class="o">.</span><span class="n">highlightedIndex</span> <span class="kr">of</span>
        <span class="n">true</span> <span class="ow">-&gt;</span> <span class="p">[</span> <span class="kt">HP</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="kt">HH</span><span class="o">.</span><span class="kt">AttrName</span> <span class="s">&quot;style&quot;</span><span class="p">)</span> <span class="s">&quot;color: red;&quot;</span> <span class="p">]</span>
        <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="kt">[]</span>
  <span class="p">)</span>
  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">]</span>
</pre></div>
</td></tr></table>

<p>To recap, we'll use these helper functions in the overall render function we're passing to <code>Select</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">typeahead</span> <span class="n">parentState</span> <span class="n">childState</span> <span class="ow">=</span>
  <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
  <span class="p">[</span> <span class="n">renderSelections</span><span class="p">,</span> <span class="n">renderInput</span><span class="p">,</span> <span class="n">renderContainer</span> <span class="p">]</span>
  <span class="kr">where</span>
    <span class="n">renderSelections</span> <span class="ow">=</span> <span class="o">...</span>
    <span class="n">renderInput</span> <span class="ow">=</span> <span class="o">...</span>
    <span class="n">renderContainer</span> <span class="ow">=</span> <span class="o">...</span>
</pre></div>
</td></tr></table>

<p>If you got a little lost in all the rendering code here, don't worry: the full code is contained at the end of the tutorial.</p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>That's it! We now have a fully-functioning typeahead that will fetch data remotely after debouncing a user's search, and if there are no results, will allow the user to refresh the data. Notably, several parts of this typeahead are not supported in any way by <code>Select</code>, but we've been able to freely extend the component to make this possible.</p>
<h3 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h3>
<p>Now that you're able to build a typeahead with <code>Select</code> you know everything you need to build more complex components like date pickers and image pickers. The next tutorial in the series, <em>Let's build a date picker</em>, is currently a work in progress.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Did you notice anything you would improve about this tutorial or the <code>Select</code> library? I'd love to hear about it! Feel free to reach out on the <a href="https://functionalprogramming.slack.com/">functional programming Slack</a> or on the <a href="https://discourse.purescript.org">PureScript user forum</a>. If you found a bug or would like to make an improvement, please open an issue or pull request on the library.</p>
</div>
<h3 id="source-code">Source Code<a class="headerlink" href="#source-code" title="Permanent link">&para;</a></h3>
<p>If you'd like to use this component as a starting point from which to build your own, feel free to copy/paste the source code below.</p>
<details class="article"><summary>Full source code for the tutorial</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">module</span> <span class="nn">Component</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Prelude</span>

<span class="kr">import</span> <span class="nn">Effect.Aff</span> <span class="p">(</span><span class="kt">Aff</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Effect.Aff.Class</span> <span class="p">(</span><span class="nf">class</span> <span class="kt">MonadAff</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.Argonaut</span> <span class="p">(</span><span class="kt">Json</span><span class="p">,</span> <span class="nf">decodeJson</span><span class="p">,</span> <span class="p">(</span><span class="o">.?</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">Data.Array</span> <span class="p">(</span><span class="nf">difference</span><span class="p">,</span> <span class="nf">filter</span><span class="p">,</span> <span class="nf">mapWithIndex</span><span class="p">,</span> <span class="nf">null</span><span class="p">,</span> <span class="p">(</span><span class="o">:</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">Data.Either</span> <span class="p">(</span><span class="kt">Either</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.Maybe</span> <span class="p">(</span><span class="kt">Maybe</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">Data.Time.Duration</span> <span class="p">(</span><span class="kt">Milliseconds</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">Data.Traversable</span> <span class="p">(</span><span class="nf">traverse</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Halogen</span> <span class="k">as</span> <span class="n">H</span>
<span class="kr">import</span> <span class="nn">Halogen.HTML</span> <span class="k">as</span> <span class="n">HH</span>
<span class="kr">import</span> <span class="nn">Halogen.HTML.Events</span> <span class="k">as</span> <span class="n">HE</span>
<span class="kr">import</span> <span class="nn">Halogen.HTML.Properties</span> <span class="p">(</span><span class="nf">attr</span><span class="p">)</span> <span class="n">as</span> <span class="kt">HP</span>
<span class="kr">import</span> <span class="nn">Network.HTTP.Affjax</span> <span class="k">as</span> <span class="n">AX</span>
<span class="kr">import</span> <span class="nn">Network.HTTP.Affjax.Response</span> <span class="k">as</span> <span class="n">Response</span>
<span class="kr">import</span> <span class="nn">Network.RemoteData</span> <span class="p">(</span><span class="kt">RemoteData</span><span class="p">(</span><span class="o">..</span><span class="p">),</span> <span class="nf">fromEither</span><span class="p">,</span> <span class="nf">withDefault</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Select</span> <span class="k">as</span> <span class="n">Select</span>
<span class="kr">import</span> <span class="nn">Select.Setters</span> <span class="k">as</span> <span class="n">Setters</span>

<span class="kr">data</span> <span class="kt">Query</span> <span class="n">a</span>
  <span class="ow">=</span> <span class="kt">HandleSelect</span> <span class="p">(</span><span class="kt">Select</span><span class="o">.</span><span class="kt">Message</span> <span class="kt">Query</span> <span class="kt">String</span><span class="p">)</span> <span class="n">a</span>
  <span class="o">|</span> <span class="kt">Remove</span> <span class="kt">String</span> <span class="n">a</span>

<span class="kr">type</span> <span class="kt">State</span> <span class="ow">=</span>
  <span class="p">{</span> <span class="n">items</span> <span class="ow">::</span> <span class="kt">RemoteData</span> <span class="kt">String</span> <span class="p">(</span><span class="kt">Array</span> <span class="kt">String</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">selections</span> <span class="ow">::</span> <span class="kt">Array</span> <span class="kt">String</span>
  <span class="p">}</span>

<span class="kr">type</span> <span class="kt">Input</span> <span class="ow">=</span> <span class="kt">Unit</span>

<span class="kr">type</span> <span class="kt">Message</span> <span class="ow">=</span> <span class="kt">Void</span>

<span class="kr">type</span> <span class="kt">ChildSlot</span> <span class="ow">=</span> <span class="kt">Unit</span>
<span class="kr">type</span> <span class="kt">ChildQuery</span> <span class="ow">=</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Query</span> <span class="kt">Query</span> <span class="kt">String</span>

<span class="nf">component</span> <span class="ow">::</span> <span class="err">∀</span> <span class="n">m</span>
  <span class="o">.</span> <span class="kt">MonadAff</span> <span class="n">m</span>
 <span class="ow">=&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">Component</span> <span class="kt">HH</span><span class="o">.</span><span class="kt">HTML</span> <span class="kt">Query</span> <span class="kt">Input</span> <span class="kt">Message</span> <span class="n">m</span>
<span class="nf">component</span> <span class="ow">=</span>
  <span class="kt">H</span><span class="o">.</span><span class="n">parentComponent</span>
    <span class="p">{</span> <span class="n">initialState</span>
    <span class="p">,</span> <span class="n">render</span>
    <span class="p">,</span> <span class="n">eval</span>
    <span class="p">,</span> <span class="n">receiver</span><span class="kt">:</span> <span class="n">const</span> <span class="kt">Nothing</span>
    <span class="p">}</span>
  <span class="kr">where</span>

  <span class="n">initialState</span> <span class="ow">::</span> <span class="kt">Input</span> <span class="ow">-&gt;</span> <span class="kt">State</span>
  <span class="n">initialState</span> <span class="ow">=</span> <span class="n">const</span>
    <span class="p">{</span> <span class="n">items</span><span class="kt">:</span> <span class="kt">NotAsked</span>
    <span class="p">,</span> <span class="n">selections</span><span class="kt">:</span> <span class="kt">[]</span>
    <span class="p">}</span>

  <span class="n">fetchItems</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Aff</span> <span class="p">(</span><span class="kt">Either</span> <span class="kt">String</span> <span class="p">(</span><span class="kt">Array</span> <span class="kt">String</span><span class="p">))</span>
  <span class="n">fetchItems</span> <span class="n">str</span> <span class="ow">=</span> <span class="kr">do</span>
     <span class="n">res</span> <span class="ow">&lt;-</span> <span class="kr">_</span><span class="o">.</span><span class="n">response</span> <span class="o">&lt;$&gt;</span>
       <span class="p">(</span> <span class="kt">AX</span><span class="o">.</span><span class="n">get</span>
       <span class="o">$</span> <span class="kt">Response</span><span class="o">.</span><span class="n">json</span>
       <span class="o">$</span> <span class="s">&quot;https://swapi.co/api/people/?search=&quot;</span> <span class="o">&lt;&gt;</span> <span class="n">str</span>
       <span class="p">)</span>


     <span class="n">pure</span> <span class="o">$</span> <span class="kr">do</span>
       <span class="n">obj</span> <span class="ow">&lt;-</span> <span class="n">decodeJson</span> <span class="n">res</span>
       <span class="n">arr</span> <span class="ow">&lt;-</span> <span class="n">obj</span> <span class="o">.?</span> <span class="s">&quot;results&quot;</span>
       <span class="n">traverse</span> <span class="p">(</span><span class="n">decodeJson</span> <span class="o">&lt;=&lt;</span> <span class="n">flip</span> <span class="p">(</span><span class="o">.?</span><span class="p">)</span> <span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="n">arr</span>

  <span class="n">render</span> <span class="ow">::</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentHTML</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="n">m</span>
  <span class="n">render</span> <span class="n">st</span> <span class="ow">=</span>
    <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">slot</span> <span class="n">unit</span> <span class="kt">Select</span><span class="o">.</span><span class="n">component</span> <span class="n">selectInput</span> <span class="p">(</span><span class="kt">HE</span><span class="o">.</span><span class="n">input</span> <span class="kt">HandleSelect</span><span class="p">)</span> <span class="p">]</span>

    <span class="kr">where</span>

    <span class="n">selectInput</span> <span class="ow">::</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">Input</span> <span class="kt">Query</span> <span class="kt">String</span>
    <span class="n">selectInput</span> <span class="ow">=</span>
      <span class="p">{</span> <span class="n">inputType</span><span class="kt">:</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">TextInput</span>
      <span class="p">,</span> <span class="n">items</span><span class="kt">:</span> <span class="kt">[]</span>
      <span class="p">,</span> <span class="n">initialSearch</span><span class="kt">:</span> <span class="kt">Nothing</span>
      <span class="p">,</span> <span class="n">debounceTime</span><span class="kt">:</span> <span class="kt">Just</span> <span class="o">$</span> <span class="kt">Milliseconds</span> <span class="mf">250.0</span>
      <span class="p">,</span> <span class="n">render</span><span class="kt">:</span> <span class="n">typeahead</span> <span class="n">st</span>
      <span class="p">}</span>

    <span class="n">typeahead</span>
      <span class="ow">::</span> <span class="kt">State</span>
      <span class="ow">-&gt;</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">State</span> <span class="kt">String</span>
      <span class="ow">-&gt;</span> <span class="kt">Select</span><span class="o">.</span><span class="kt">ComponentHTML</span> <span class="kt">Query</span> <span class="kt">String</span>
    <span class="n">typeahead</span> <span class="n">parentState</span> <span class="n">childState</span> <span class="ow">=</span>
      <span class="kt">HH</span><span class="o">.</span><span class="n">div_</span>
      <span class="p">[</span> <span class="n">renderSelections</span><span class="p">,</span> <span class="n">renderInput</span><span class="p">,</span> <span class="n">renderContainer</span> <span class="p">]</span>
      <span class="kr">where</span>
        <span class="c1">-- The items that have already been selected and can be removed</span>
        <span class="n">renderSelections</span> <span class="ow">=</span>
          <span class="kt">HH</span><span class="o">.</span><span class="n">ul_</span>
          <span class="p">(</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span> <span class="o">&lt;#&gt;</span>
              <span class="p">(</span><span class="nf">\</span><span class="n">item</span> <span class="ow">-&gt;</span>
                <span class="kt">HH</span><span class="o">.</span><span class="n">li</span>
                <span class="p">[</span> <span class="kt">HE</span><span class="o">.</span><span class="n">onClick</span> <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">always</span> <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">raise</span> <span class="o">$</span> <span class="kt">Remove</span> <span class="n">item</span> <span class="n">unit</span> <span class="p">]</span>
                <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">]</span>
              <span class="p">)</span>
          <span class="p">)</span>

        <span class="c1">-- The text input field that will capture key events</span>
        <span class="n">renderInput</span> <span class="ow">=</span> <span class="kt">HH</span><span class="o">.</span><span class="n">input</span> <span class="p">(</span> <span class="kt">Setters</span><span class="o">.</span><span class="n">setInputProps</span> <span class="kt">[]</span> <span class="p">)</span>

        <span class="c1">-- The parent element holding the items  container</span>
        <span class="n">renderContainer</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">childState</span><span class="o">.</span><span class="n">visibility</span> <span class="kr">of</span>
          <span class="kt">Select</span><span class="o">.</span><span class="kt">Off</span> <span class="ow">-&gt;</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;&quot;</span>
          <span class="kt">Select</span><span class="o">.</span><span class="kt">On</span> <span class="ow">-&gt;</span>
            <span class="kt">HH</span><span class="o">.</span><span class="n">ul</span>
            <span class="p">(</span> <span class="kt">Setters</span><span class="o">.</span><span class="n">setContainerProps</span> <span class="kt">[]</span> <span class="p">)</span>
            <span class="p">(</span> <span class="kr">case</span> <span class="n">null</span> <span class="n">childState</span><span class="o">.</span><span class="n">items</span> <span class="kr">of</span>
                <span class="n">false</span> <span class="ow">-&gt;</span>
                  <span class="n">mapWithIndex</span> <span class="n">renderItem</span> <span class="n">childState</span><span class="o">.</span><span class="n">items</span>
                <span class="kr">_</span> <span class="ow">-&gt;</span>
                  <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">li</span>
                    <span class="p">[</span> <span class="kt">HE</span><span class="o">.</span><span class="n">onClick</span>
                      <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">always</span>
                      <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">raise</span>
                      <span class="o">$</span> <span class="kt">HandleSelect</span> <span class="p">(</span><span class="kt">Select</span><span class="o">.</span><span class="kt">Searched</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="n">unit</span>
                    <span class="p">]</span>
                    <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="s">&quot;Fetch data again.&quot;</span> <span class="p">]</span>
                  <span class="p">]</span>
            <span class="p">)</span>

        <span class="c1">-- Each individual item, which will receive an index and the item</span>
        <span class="n">renderItem</span> <span class="n">ix</span> <span class="n">item</span> <span class="ow">=</span>
          <span class="kt">HH</span><span class="o">.</span><span class="n">li</span>
          <span class="p">(</span> <span class="kt">Setters</span><span class="o">.</span><span class="n">setItemProps</span> <span class="n">ix</span>
            <span class="c1">-- If this is the highlighted item, then apply CSS</span>
            <span class="o">$</span> <span class="kr">case</span> <span class="kt">Just</span> <span class="n">ix</span> <span class="o">==</span> <span class="n">childState</span><span class="o">.</span><span class="n">highlightedIndex</span> <span class="kr">of</span>
                <span class="n">true</span> <span class="ow">-&gt;</span> <span class="p">[</span> <span class="kt">HP</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="kt">HH</span><span class="o">.</span><span class="kt">AttrName</span> <span class="s">&quot;style&quot;</span><span class="p">)</span> <span class="s">&quot;color: red;&quot;</span> <span class="p">]</span>
                <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="kt">[]</span>
          <span class="p">)</span>
          <span class="p">[</span> <span class="kt">HH</span><span class="o">.</span><span class="n">text</span> <span class="n">item</span> <span class="p">]</span>


  <span class="n">eval</span> <span class="ow">::</span> <span class="kt">Query</span> <span class="o">~&gt;</span> <span class="kt">H</span><span class="o">.</span><span class="kt">ParentDSL</span> <span class="kt">State</span> <span class="kt">Query</span> <span class="kt">ChildQuery</span> <span class="kt">ChildSlot</span> <span class="kt">Message</span> <span class="n">m</span>
  <span class="n">eval</span> <span class="ow">=</span> <span class="kr">case</span> <span class="kr">_</span> <span class="kr">of</span>
    <span class="kt">Remove</span> <span class="n">item</span> <span class="n">next</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
      <span class="kt">H</span><span class="o">.</span><span class="n">modify</span> <span class="nf">\</span><span class="n">st</span> <span class="ow">-&gt;</span> <span class="n">st</span> <span class="p">{</span> <span class="n">selections</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="kr">_</span> <span class="o">/=</span> <span class="n">item</span><span class="p">)</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span> <span class="p">}</span>
      <span class="n">st</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">get</span>
      <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">query</span> <span class="n">unit</span>
        <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">replaceItems</span>
        <span class="o">$</span> <span class="n">difference</span> <span class="p">(</span><span class="n">withDefault</span> <span class="kt">[]</span> <span class="n">st</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span>
      <span class="n">pure</span> <span class="n">next</span>

    <span class="kt">HandleSelect</span> <span class="n">message</span> <span class="n">next</span> <span class="ow">-&gt;</span> <span class="kr">case</span> <span class="n">message</span> <span class="kr">of</span>
      <span class="kt">Select</span><span class="o">.</span><span class="kt">Searched</span> <span class="n">string</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
        <span class="kt">H</span><span class="o">.</span><span class="n">modify</span> <span class="kr">_</span> <span class="p">{</span> <span class="n">items</span> <span class="ow">=</span> <span class="kt">Loading</span> <span class="p">}</span>
        <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">query</span> <span class="n">unit</span> <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">replaceItems</span> <span class="kt">[]</span>
        <span class="n">newItems</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">liftAff</span> <span class="p">(</span><span class="n">fetchItems</span> <span class="n">string</span><span class="p">)</span>
        <span class="kt">H</span><span class="o">.</span><span class="n">modify</span> <span class="kr">_</span> <span class="p">{</span> <span class="n">items</span> <span class="ow">=</span> <span class="n">fromEither</span> <span class="n">newItems</span> <span class="p">}</span>

        <span class="n">st</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">get</span>
        <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">query</span> <span class="n">unit</span>
          <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">replaceItems</span>
          <span class="o">$</span> <span class="n">difference</span> <span class="p">(</span><span class="n">withDefault</span> <span class="kt">[]</span> <span class="n">st</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span>

        <span class="n">pure</span> <span class="n">next</span>

      <span class="kt">Select</span><span class="o">.</span><span class="kt">Selected</span> <span class="n">item</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
        <span class="kt">H</span><span class="o">.</span><span class="n">modify</span> <span class="nf">\</span><span class="n">st</span> <span class="ow">-&gt;</span> <span class="n">st</span> <span class="p">{</span> <span class="n">selections</span> <span class="ow">=</span> <span class="n">item</span> <span class="kt">:</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span> <span class="p">}</span>
        <span class="n">st</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">get</span>
        <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="kt">H</span><span class="o">.</span><span class="n">query</span> <span class="n">unit</span>
          <span class="o">$</span> <span class="kt">Select</span><span class="o">.</span><span class="n">replaceItems</span>
          <span class="o">$</span> <span class="n">difference</span> <span class="p">(</span><span class="n">withDefault</span> <span class="kt">[]</span> <span class="n">st</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="n">st</span><span class="o">.</span><span class="n">selections</span>
        <span class="n">pure</span> <span class="n">next</span>

      <span class="kt">Select</span><span class="o">.</span><span class="kt">VisibilityChanged</span> <span class="n">vis</span> <span class="ow">-&gt;</span>
        <span class="n">pure</span> <span class="n">next</span>

      <span class="kt">Select</span><span class="o">.</span><span class="kt">Emit</span> <span class="n">query</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
        <span class="n">eval</span> <span class="n">query</span>
        <span class="n">pure</span> <span class="n">next</span>
</pre></div>
</td></tr></table>

</details>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../dropdown/" title="Build a dropdown" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Build a dropdown
              </span>
            </div>
          </a>
        
        
          <a href="../../how-to/embed-parent-queries/" title="How to embed parent queries" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                How to embed parent queries
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 CitizenNet
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../js/app.js"></script>
      
    
  </body>
</html>